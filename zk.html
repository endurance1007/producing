<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zettelkasten Pro - Comfortable Dark Mode</title>
    <style>
        :root {
            /* ë¼ì´íŠ¸ ëª¨ë“œ (ê¸°ì¡´ ìœ ì§€) */
            --primary: #2c3e50;
            --accent: #e67e22; /* ì£¼í™©ìƒ‰ */
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #2c3e50;
            --border: #e1e4e8;
            --link: #3498db;
            --input-bg: #ffffff;
            --tag-bg: #e8ecef;
        }

        /* ë‹¤í¬ ëª¨ë“œ (íšŒìƒ‰ ê³„ì—´ë¡œ ë³€ê²½) */
        @media (prefers-color-scheme: dark) {
            body.auto-dark {
                --primary: #ecf0f1;
                --accent: #7f8c8d; /* ëˆˆì´ í¸í•œ íšŒìƒ‰ */
                --bg: #1a1a1a;
                --card-bg: #2d2d2d;
                --text: #e0e0e0;
                --border: #404040;
                --link: #5dade2;
                --input-bg: #3d3d3d;
                --tag-bg: #4a4a4a;
            }
        }

        /* ê°•ì œ ë‹¤í¬ëª¨ë“œ í´ë˜ìŠ¤ */
        body.dark-mode {
            --primary: #ecf0f1;
            --accent: #7f8c8d; /* ëˆˆì´ í¸í•œ íšŒìƒ‰ */
            --bg: #1a1a1a;
            --card-bg: #2d2d2d;
            --text: #e0e0e0;
            --border: #404040;
            --link: #5dade2;
            --input-bg: #3d3d3d;
            --tag-bg: #4a4a4a;
        }

        body { 
            font-family: 'Pretendard', -apple-system, sans-serif; 
            background: var(--bg); 
            padding: 15px; 
            color: var(--text); 
            -webkit-tap-highlight-color: transparent; 
            transition: background 0.3s, color 0.3s;
        }
        
        .container { max-width: 800px; margin: 0 auto; padding-bottom: 60px; }
        
        .top-bar { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 10px; }
        .search-box { flex: 1; min-width: 200px; padding: 12px; border: 2px solid var(--primary); border-radius: 8px; font-size: 1rem; background: var(--input-bg); color: var(--text); }
        .btn-util { padding: 10px 15px; border-radius: 6px; cursor: pointer; border: 1px solid var(--border); background: var(--card-bg); color: var(--text); font-size: 0.85rem; font-weight: bold; }

        .tag-index { background: var(--card-bg); padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .index-item { display: inline-block; padding: 6px 14px; background: var(--tag-bg); margin: 4px; border-radius: 20px; font-size: 0.9rem; text-decoration: none; color: var(--text); }

        .card-panel { background: var(--card-bg); padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); margin-bottom: 20px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .input-grid input { padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 1rem; background: var(--input-bg); color: var(--text); }
        textarea { grid-column: span 2; height: 100px; padding: 12px; border-radius: 8px; border: 1px solid var(--border); resize: none; font-size: 1rem; background: var(--input-bg); color: var(--text); }
        /* ì¹´ë“œ ë“±ë¡ ë²„íŠ¼: íšŒìƒ‰ ê³„ì—´ ì ìš© */
        .add-btn { grid-column: span 2; background: var(--accent); color: white; border: none; border-radius: 8px; padding: 15px; font-weight: bold; cursor: pointer; font-size: 1.1rem; transition: background 0.2s; }
        .add-btn:hover { background: var(--primary); color: var(--bg); }

.random-box { 
    /* ë°°ê²½ì„ ì–´ë‘ìš´ ë¬´ì±„ìƒ‰ íšŒìƒ‰(#252525)ìœ¼ë¡œ ë³€ê²½ */
    background: #252525; 
    /* ê¸€ììƒ‰ì„ ì—°í•œ íšŒìƒ‰ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ê°€ë…ì„± í™•ë³´ */
    color: #e0e0e0; 
    text-align: center; 
    padding: 25px; 
    border-radius: 15px; 
    margin-bottom: 30px;
    /* ë°•ìŠ¤ ê²½ê³„ì„ ì„ ì‚´ì§ ì£¼ì–´ ì…ì²´ê° ë¶€ì—¬ */
    border: 1px solid #404040; 
}
        /* ëœë¤ ë¯¹ìŠ¤ ë²„íŠ¼: íšŒìƒ‰ ê³„ì—´ ì ìš© */
        .random-btn { background: var(--accent); color: white; border: none; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: background 0.2s; }
        .random-btn:hover { background: var(--bg); color: var(--primary); }
        .random-display { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-top: 20px; }
        .r-card { background: var(--card-bg); color: var(--text); width: 130px; padding: 15px; border-radius: 10px; text-align: center; font-size: 0.85rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 1px solid var(--border); }

        .category-group { margin-bottom: 35px; scroll-margin-top: 20px; }
        .z-card { background: var(--card-bg); border: 1px solid var(--border); padding: 15px; border-radius: 10px; margin-bottom: 10px; }
        .num-tag { color: var(--accent); font-weight: 900; font-size: 1.1rem; margin-bottom: 8px; display: block; }
        .wiki-link { color: var(--link); font-weight: bold; }
        .actions { margin-top: 12px; display: flex; gap: 10px; }
        .btn-sm { flex: 1; padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg); color: var(--text); cursor: pointer; font-size: 0.85rem; }
        
        .mode-toggle { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 25px; background: var(--primary); color: var(--bg); border: none; cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 1000; }
    </style>
</head>
<body class="auto-dark">

<button class="mode-toggle" onclick="toggleDarkMode()">ğŸŒ“</button>

<div class="container">
    <div class="top-bar">
        <input type="text" id="searchBar" class="search-box" placeholder="ê²€ìƒ‰..." oninput="renderList()">
        <button class="btn-util" onclick="exportData()">ğŸ“¤ ë°±ì—…</button>
        <button class="btn-util" onclick="document.getElementById('fileInput').click()">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <input type="file" id="fileInput" style="display:none" onchange="importData(event)" accept=".json">
    </div>

    <div class="tag-index">
        <div id="indexContainer"></div>
    </div>

    <div class="random-box">
        <button class="random-btn" onclick="drawCards()">ğŸ² ë¬´ì‘ìœ„ ë¯¹ìŠ¤ ì¶”ì¶œ</button>
        <div id="randomDisplay" class="random-display"></div>
    </div>

    <div class="card-panel">
        <div class="input-grid">
            <input type="text" id="cardNumber" placeholder="ì¹´ë“œ ë²ˆí˜¸">
            <input type="text" id="tags" placeholder="íƒœê·¸">
            <textarea id="summary" placeholder="ìš”ì•½ ë‚´ìš©... [[ë²ˆí˜¸]] ì…ë ¥ ì‹œ ê°•ì¡°"></textarea>
            <button class="add-btn" onclick="addCard()">ì¹´ë“œ ë“±ë¡</button>
        </div>
    </div>

    <div id="categoryList"></div>
</div>

<script>
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        localStorage.setItem('zettel_theme', isDark ? 'dark' : 'light');
    }

    if (localStorage.getItem('zettel_theme') === 'dark') {
        document.body.classList.add('dark-mode');
    }

    let cards = JSON.parse(localStorage.getItem('zettel_v_ipad_final')) || [];

    function addCard() {
        const num = document.getElementById('cardNumber').value.trim();
        const tagInput = document.getElementById('tags').value.trim();
        const summary = document.getElementById('summary').value.trim();
        if(!num) return alert("ë²ˆí˜¸ í•„ìˆ˜!");
        cards.push({ id: Date.now(), num, tags: tagInput ? tagInput.split(',').map(t => t.trim()) : ['ë¯¸ë¶„ë¥˜'], summary });
        saveAndRender();
        document.getElementById('cardNumber').value = '';
        document.getElementById('tags').value = '';
        document.getElementById('summary').value = '';
    }

    function saveAndRender() {
        localStorage.setItem('zettel_v_ipad_final', JSON.stringify(cards));
        renderList();
    }

    async function exportData() {
        if (cards.length === 0) return;
        const defaultName = `zettel_${new Date().toISOString().slice(0,10).replace(/-/g,'')}.json`;
        const fileName = prompt("íŒŒì¼ ì´ë¦„:", defaultName);
        if (!fileName) return;

        const dataStr = JSON.stringify(cards, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const finalName = fileName.endsWith('.json') ? fileName : fileName + '.json';

        if (navigator.share) {
            const file = new File([blob], finalName, { type: "application/json" });
            try { await navigator.share({ files: [file], title: 'Zettel Backup' }); } 
            catch (err) { if(err.name !== 'AbortError') fallbackDownload(blob, finalName); }
        } else { fallbackDownload(blob, finalName); }
    }

    function fallbackDownload(blob, fileName) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = fileName;
        document.body.appendChild(a); a.click();
        document.body.removeChild(a);
    }

    function importData(event) {
        const reader = new FileReader();
        reader.onload = (e) => { cards = JSON.parse(e.target.result); saveAndRender(); };
        reader.readAsText(event.target.files[0]);
    }

    function renderList() {
        const search = document.getElementById('searchBar').value.toLowerCase();
        const listDiv = document.getElementById('categoryList');
        const indexDiv = document.getElementById('indexContainer');
        listDiv.innerHTML = ''; indexDiv.innerHTML = '';
        const tagGroups = {};

        cards.forEach(card => {
            if(card.num.toLowerCase().includes(search) || card.summary.toLowerCase().includes(search)) {
                card.tags.forEach(tag => { (tagGroups[tag] = tagGroups[tag] || []).push(card); });
            }
        });

        Object.keys(tagGroups).sort().forEach(tag => {
            indexDiv.innerHTML += `<a class="index-item" href="#tag-${tag}">${tag} (${tagGroups[tag].length})</a>`;
            let section = `<div class="category-group" id="tag-${tag}"><h3># ${tag}</h3>`;
            tagGroups[tag].forEach(card => {
                const displaySummary = card.summary.replace(/\[\[(.*?)\]\]/g, '<b class="wiki-link">[[ $1 ]]</b>');
                section += `<div class="z-card"><span class="num-tag">${card.num}</span><div>${displaySummary}</div><div class="actions"><button class="btn-sm" onclick="editCard(${card.id})">ìˆ˜ì •</button><button class="btn-sm" style="color:#e74c3c" onclick="deleteCard(${card.id})">ì‚­ì œ</button></div></div>`;
            });
            listDiv.innerHTML += section + `</div>`;
        });
    }

    function editCard(id) {
        const c = cards.find(i => i.id === id);
        const n = prompt("ë²ˆí˜¸:", c.num); if(!n) return;
        c.num = n; c.tags = prompt("íƒœê·¸:", c.tags.join(', ')).split(',').map(t=>t.trim()); c.summary = prompt("ë‚´ìš©:", c.summary);
        saveAndRender();
    }

    function deleteCard(id) { if(confirm("ì‚­ì œ?")) { cards = cards.filter(i => i.id !== id); saveAndRender(); } }

    function drawCards() {
        const display = document.getElementById('randomDisplay');
        display.innerHTML = '';
        [...cards].sort(() => 0.5 - Math.random()).slice(0, Math.floor(Math.random()*3)+3).forEach(c => {
            display.innerHTML += `<div class="r-card"><b>${c.num}</b><br><small>${c.summary.substring(0,25)}...</small></div>`;
        });
    }

    renderList();
</script>
</body>
</html>
