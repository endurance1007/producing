<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€í˜œì˜ ìš© | ê°ìƒ‰ ì›Œí¬ìŠ¤í…Œì´ì…˜ v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        
        /* í•˜ì´ë¼ì´íŒ… ìŠ¤íƒ€ì¼ (B) */
        .hl-dialog { color: #60a5fa; font-weight: 600; } /* ëŒ€ì‚¬: íŒŒë€ìƒ‰ */
        .hl-sfx { color: #fbbf24; font-style: italic; } /* íš¨ê³¼ìŒ: ë…¸ë€ìƒ‰ */
        .hl-action { color: #d1d5db; } /* ì§€ë¬¸: ê¸°ë³¸ íšŒìƒ‰ */

        .card-anim { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }
        
        [contenteditable]:focus { outline: none; background: rgba(59, 130, 246, 0.05); border-radius: 4px; }
    </style>
</head>
<body class="bg-[#0c0c0c] text-gray-200 h-screen overflow-hidden flex flex-col">

    <header class="h-14 border-b border-white/5 flex items-center justify-between px-6 shrink-0 bg-[#0f0f0f]">
        <div class="flex items-center gap-2">
            <span class="text-xl">ğŸ²</span>
            <h1 class="font-black tracking-tight text-blue-500 uppercase">Dragon Adapter <span class="text-gray-600 font-light ml-2 text-sm">v2.0</span></h1>
        </div>
        <div class="flex gap-4 items-center">
            <div id="stats" class="text-[10px] text-gray-500 font-mono uppercase tracking-widest">Ready</div>
            <button onclick="parseSource()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1 rounded text-xs font-bold transition">ë¶„í•´ ì‹œì‘</button>
        </div>
    </header>

    <main class="flex flex-1 overflow-hidden">
        
        <section class="w-1/3 flex flex-col border-r border-white/5 bg-[#0a0a0a]">
            <div class="p-3 bg-white/5 text-[10px] uppercase tracking-tighter text-gray-400 font-bold">Source Text</div>
            <textarea id="sourceInput" 
                      class="flex-1 bg-transparent p-6 outline-none resize-none leading-relaxed text-gray-500 focus:text-gray-300 transition-colors text-sm"
                      placeholder="ì›ì‘ í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ê³  'ë¶„í•´ ì‹œì‘'ì„ ëˆ„ë¥´ì„¸ìš”..."></textarea>
        </section>

        <section class="w-2/3 flex flex-col">
            <div class="p-3 bg-black/40 text-[10px] uppercase tracking-tighter text-blue-400 font-bold flex justify-between items-center">
                <span>Adapter Board (Interactive)</span>
                <span id="panelCount" class="bg-blue-900/30 px-2 py-0.5 rounded">0 Panels</span>
            </div>
            
            <div id="panelContainer" class="flex-1 overflow-y-auto p-8 space-y-4">
                <div class="h-full flex flex-col items-center justify-center text-gray-700 italic text-sm space-y-2">
                    <p>ë¶„í•´ëœ ì¹´ë“œê°€ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    <p class="text-[11px] not-italic opacity-50">ì¹´ë“œì˜ í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ê±°ë‚˜ ë²„íŠ¼ìœ¼ë¡œ ë³‘í•©/ë¶„í•  í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </section>

    </main>

    <script>
        const sourceInput = document.getElementById('sourceInput');
        const panelContainer = document.getElementById('panelContainer');
        const panelCountDisplay = document.getElementById('panelCount');

        // B: í•˜ì´ë¼ì´íŒ… ì—”ì§„
        function highlightText(text) {
            // 1. ëŒ€ì‚¬: " " ë˜ëŠ” ' ' ì‚¬ì´ì˜ ë¬¸êµ¬
            text = text.replace(/(["'])(?:(?=(\\?))\2.)*?\1/g, '<span class="hl-dialog">$&</span>');
            // 2. íš¨ê³¼ìŒ: ( ) ë˜ëŠ” [ ] ì‚¬ì´ì˜ ë¬¸êµ¬
            text = text.replace(/[\(\[][ê°€-í£a-zA-Z\s]+[\)\]]/g, '<span class="hl-sfx">$&</span>');
            return text;
        }

        function parseSource() {
            const text = sourceInput.value.trim();
            if (!text) return;

            const sentenceRegex = /(?<=[.!?])\s+/;
            const sentences = text.split(sentenceRegex).filter(s => s.length > 0);
            renderPanels(sentences);
        }

        function renderPanels(sentences) {
            panelContainer.innerHTML = '';
            sentences.forEach((s, i) => createCard(s));
            updateStats();
        }

        function createCard(text, referenceNode = null) {
            const card = document.createElement('div');
            card.className = 'card-anim bg-[#141414] border border-white/5 rounded-lg p-5 hover:border-white/20 transition-all group';
            
            card.innerHTML = `
                <div class="flex items-start gap-4">
                    <span class="panel-num text-[10px] font-mono text-gray-600 mt-1 font-bold shrink-0">00</span>
                    <div class="content-area flex-1 text-sm leading-relaxed text-gray-300 outline-none" contenteditable="true">
                        ${highlightText(text)}
                    </div>
                    
                    <div class="flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity shrink-0">
                        <button onclick="mergeUp(this)" title="ìœ„ë¡œ ë³‘í•©" class="p-1 hover:text-blue-500 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" /></svg>
                        </button>
                        <button onclick="splitCard(this)" title="ë¶„í• " class="p-1 hover:text-yellow-500 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5" /></svg>
                        </button>
                    </div>
                </div>
            `;

            if (referenceNode) {
                panelContainer.insertBefore(card, referenceNode.nextSibling);
            } else {
                panelContainer.appendChild(card);
            }
            
            // í…ìŠ¤íŠ¸ ìˆ˜ì • ì‹œ ì‹¤ì‹œê°„ í•˜ì´ë¼ì´íŒ… ì ìš© (ì„±ëŠ¥ì„ ìœ„í•´ í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œ ì ìš©)
            const contentArea = card.querySelector('.content-area');
            contentArea.addEventListener('blur', function() {
                this.innerHTML = highlightText(this.innerText);
            });

            updateStats();
        }

        // A-1: ìœ„ë¡œ ë³‘í•© ê¸°ëŠ¥
        function mergeUp(btn) {
            const currentCard = btn.closest('.group');
            const prevCard = currentCard.previousElementSibling;
            if (prevCard && prevCard.querySelector('.content-area')) {
                const prevArea = prevCard.querySelector('.content-area');
                const currentArea = currentCard.querySelector('.content-area');
                prevArea.innerText = prevArea.innerText + " " + currentArea.innerText;
                prevArea.innerHTML = highlightText(prevArea.innerText);
                currentCard.remove();
                updateStats();
            }
        }

        // A-2: ë¶„í•  ê¸°ëŠ¥ (ë‹¨ìˆœ 2ë“±ë¶„ ë¶„í• )
        function splitCard(btn) {
            const currentCard = btn.closest('.group');
            const contentArea = currentCard.querySelector('.content-area');
            const text = contentArea.innerText;
            const mid = Math.floor(text.length / 2);
            
            // ì‹¤ì œ ì‘ì—… ì‹œì—ëŠ” ì»¤ì„œ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ìª¼ê°œëŠ” ê²Œ ì¢‹ì§€ë§Œ, ë°”ì´ë¸Œ ì½”ë”©ì—ì„œëŠ” ë‹¨ìˆœ ë¶„í•  ë²„íŠ¼ìœ¼ë¡œ êµ¬í˜„
            const firstHalf = text.slice(0, mid);
            const secondHalf = text.slice(mid);
            
            contentArea.innerText = firstHalf;
            contentArea.innerHTML = highlightText(firstHalf);
            createCard(secondHalf, currentCard);
        }

        function updateStats() {
            const cards = panelContainer.querySelectorAll('.group');
            panelCountDisplay.innerText = `${cards.length} Panels`;
            cards.forEach((card, i) => {
                card.querySelector('.panel-num').innerText = String(i + 1).padStart(2, '0');
            });
        }
    </script>
</body>
</html>
