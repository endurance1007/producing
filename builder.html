<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Engine v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .tab-active { border-left: 4px solid #3b82f6; background-color: #1f2937; color: white; }
        .input-dark { @apply w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-blue-500 focus:outline-none; }
        .label-main { @apply block text-sm font-bold text-blue-400 mb-1; }
        .label-sub { @apply block text-xs text-gray-500 mb-1; }
    </style>
</head>
<body class="bg-gray-900 text-gray-300 font-sans h-screen flex overflow-hidden">

    <aside class="w-72 bg-gray-800 flex flex-col border-r border-gray-700 flex-shrink-0">
        <div class="p-6 border-b border-gray-700">
            <h1 class="text-xl font-bold text-blue-400">ğŸ§¬ Story Engine</h1>
            <p class="text-xs text-gray-500 mt-1">v2.0 : 23ë‹¨ê³„ ìŠ¤í† ë¦¬ ë¹Œë”</p>
        </div>
        <nav class="flex-1 overflow-y-auto py-4 space-y-1">
            <button onclick="switchTab('concept')" id="btn-concept" class="w-full text-left px-6 py-3 hover:bg-gray-700 transition tab-active">
                1. ì»¨ì…‰ & ì„¸ê³„ê´€ (ë¼ˆëŒ€)
            </button>
            <button onclick="switchTab('characters')" id="btn-characters" class="w-full text-left px-6 py-3 hover:bg-gray-700 transition">
                2. ìºë¦­í„° ë© (ìƒì„¸ ì„¤ì •)
            </button>
            <button onclick="switchTab('plot')" id="btn-plot" class="w-full text-left px-6 py-3 hover:bg-gray-700 transition">
                3. 23ë‹¨ê³„ í”Œë¡¯ (íŒŒë™)
            </button>
        </nav>
        <div class="p-4 border-t border-gray-700">
            <button onclick="exportData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded font-bold transition flex items-center justify-center gap-2">
                <span>ğŸ“¥ JSON ë‚´ë³´ë‚´ê¸°</span>
            </button>
            <button onclick="clearData()" class="w-full mt-2 text-xs text-red-400 hover:text-red-300">
                ì´ˆê¸°í™”
            </button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto bg-gray-900 p-8 relative">
        <div id="save-status" class="fixed top-4 right-8 text-xs text-green-500 opacity-0 transition-opacity font-bold">
            âœ“ ìë™ ì €ì¥ë¨
        </div>

        <section id="tab-concept" class="max-w-4xl mx-auto space-y-10">
            <div>
                <h2 class="text-2xl font-bold text-white mb-6 border-b border-gray-700 pb-2">Step 1. ì´ì•¼ê¸°ì˜ ë¼ˆëŒ€ (Concept)</h2>
                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <span class="label-main">1. ì•„ì´ëŸ¬ë‹ˆ ë¡œê·¸ë¼ì¸</span>
                        <span class="label-sub">ì£¼ì¸ê³µì˜ íŠ¹ì„±ê³¼ ìƒí™©ì´ ì¶©ëŒí•˜ëŠ” í•œ ë¬¸ì¥ ("Aì„ì—ë„ ë¶ˆêµ¬í•˜ê³  Bí•´ì•¼ í•œë‹¤")</span>
                        <textarea id="f_logline" oninput="saveData()" rows="2" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-blue-500 focus:outline-none"></textarea>
                    </div>
                    <div>
                        <span class="label-main">2. í•µì‹¬ ì§ˆë¬¸ (Dramatic Question)</span>
                        <span class="label-sub">ë…ìê°€ ëê¹Œì§€ ê¶ê¸ˆí•´í•  ì§ˆë¬¸ ("ê³¼ì—° ì£¼ì¸ê³µì€ ~í•  ìˆ˜ ìˆì„ê¹Œ?")</span>
                        <input type="text" id="f_question" oninput="saveData()" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-blue-500 focus:outline-none">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <span class="label-main">3. íƒ€ê²Ÿ & ì¥ë¥´</span>
                            <input type="text" id="f_target" oninput="saveData()" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-blue-500 focus:outline-none">
                        </div>
                        <div>
                            <span class="label-main">4. ì°¨ë³„í™” í¬ì¸íŠ¸ (The Hook)</span>
                            <input type="text" id="f_hook" oninput="saveData()" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-blue-500 focus:outline-none">
                        </div>
                    </div>
                     <div>
                        <span class="label-main">23. í…Œë§ˆ (Controlling Idea) - *ë¨¼ì € ì„¤ì • ì¶”ì²œ*</span>
                        <span class="label-sub">"ê²°êµ­ ì´ ì´ì•¼ê¸°ëŠ” ~ì— ê´€í•œ ê²ƒì´ë‹¤" (ì´ì•¼ê¸°ì˜ ë§ˆì¹¨í‘œ)</span>
                        <input type="text" id="f_theme" oninput="saveData()" class="w-full bg-gray-800 border border-blue-500 rounded p-3 text-white focus:outline-none font-bold">
                    </div>
                </div>
            </div>

            <div>
                <h2 class="text-2xl font-bold text-white mb-6 border-b border-gray-700 pb-2">Step 3. ì„¸ê³„ê´€ê³¼ ê·œì¹™ (World Building)</h2>
                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <span class="label-main">11. ê³µê°„ì  ë°°ê²½</span>
                        <span class="label-sub">ì£¼ëœ ë¬´ëŒ€ì˜ ë¶„ìœ„ê¸°ì™€ íŠ¹ì„±</span>
                        <textarea id="f_setting" oninput="saveData()" rows="2" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-blue-500 focus:outline-none"></textarea>
                    </div>
                    <div>
                        <span class="label-main">12. ì‘ë™ ì›ë¦¬ & ì œì•½ (Rules)</span>
                        <span class="label-sub">ì´ ì„¸ê³„ì—ì„œ ì ˆëŒ€ ì–´ê¸¸ ìˆ˜ ì—†ëŠ” ë²•ì¹™ì´ë‚˜ í•œê³„</span>
                        <textarea id="f_rules" oninput="saveData()" rows="2" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-blue-500 focus:outline-none"></textarea>
                    </div>
                    <div>
                        <span class="label-main">13. ì¼ìƒì˜ ëª¨ìŠµ (Status Quo)</span>
                        <span class="label-sub">ì‚¬ê±´ì´ í„°ì§€ê¸° ì „, ì£¼ì¸ê³µì´ ëˆ„ë¦¬ë˜(í˜¹ì€ ê²¬ë””ë˜) í‰ë²”í•œ ì¼ìƒ</span>
                        <textarea id="f_statusQuo" oninput="saveData()" rows="2" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-blue-500 focus:outline-none"></textarea>
                    </div>
                </div>
            </div>
        </section>

        <section id="tab-characters" class="max-w-5xl mx-auto space-y-8 hidden">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-white">Step 2. ìºë¦­í„° ë© (Character Lab)</h2>
                    <p class="text-sm text-gray-500">í•­ëª© 5~10ì„ í¬í•¨í•œ ì •ë°€ ì„¤ê³„</p>
                </div>
                <button onclick="addCharacter()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold transition shadow-lg">+ ìºë¦­í„° ì¶”ê°€</button>
            </div>
            
            <div id="character-list" class="space-y-8">
                </div>
        </section>

        <section id="tab-plot" class="max-w-4xl mx-auto space-y-12 hidden">
             <div>
                <h2 class="text-2xl font-bold text-white mb-2 border-b border-gray-700 pb-2">Step 4. í”Œë¡¯ì˜ íŒŒë™ (Plotting)</h2>
                <p class="text-gray-500 mb-6">ì‹œê°„ ìˆœì„œê°€ ì•„ë‹Œ ì‚¬ê±´ì˜ ê°•ë„ ìˆœì„œë¡œ ë°°ì¹˜</p>
                
                <div class="space-y-8">
                    <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-blue-500">
                        <span class="label-main text-lg">14. ë„ì…ë¶€ ì‚¬ê±´ (Inciting Incident)</span>
                        <span class="label-sub">ì£¼ì¸ê³µì˜ ì¼ìƒì— ë¶ˆì„ ì§€ë¥´ëŠ” ì‚¬ê±´ / ê±°ì ˆí•  ìˆ˜ ì—†ëŠ” ì œì•ˆ</span>
                        <textarea id="p_14" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-blue-500 mt-2"></textarea>
                    </div>

                    <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-indigo-500">
                        <span class="label-main text-lg">15. ëŒì´í‚¬ ìˆ˜ ì—†ëŠ” ì§€ì  (Point of No Return)</span>
                        <span class="label-sub">ì£¼ì¸ê³µì´ ìƒˆë¡œìš´ ì„¸ê³„ë¡œ ì™„ì „íˆ ë°œì„ ë“¤ì´ëŠ” ìˆœê°„</span>
                        <textarea id="p_15" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-indigo-500 mt-2"></textarea>
                    </div>

                    <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-indigo-500">
                        <span class="label-main text-lg">16. ìƒìŠ¹í•˜ëŠ” í–‰ë™ (Rising Action) & ì‹œë ¨ë“¤</span>
                        <span class="label-sub">ëª©í‘œë¥¼ í–¥í•´ ê°€ë©° ê²ªëŠ” 3~4ê°œì˜ ì ì  ì»¤ì§€ëŠ” ì¥ì• ë¬¼</span>
                        <textarea id="p_16" oninput="saveData()" rows="4" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-indigo-500 mt-2"></textarea>
                    </div>

                    <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-purple-500 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-2 opacity-10 text-6xl font-black text-purple-500">MID</div>
                        <span class="label-main text-lg">17. ë¯¸ë“œí¬ì¸íŠ¸ (Mid-point)</span>
                        <span class="label-sub">ìˆ˜ë™ì  -> ëŠ¥ë™ì  ë³€í™” / ì •ë³´ì˜ ë°˜ì „ / "ì´ì œ ì¥ë‚œì€ ëë‚¬ë‹¤"</span>
                        <textarea id="p_17" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-purple-500 mt-2"></textarea>
                    </div>

                    <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-orange-500">
                        <span class="label-main text-lg">18. íŒëˆì˜ ìƒìŠ¹ (Raising Stakes)</span>
                        <span class="label-sub">ì‹¤íŒ¨ ì‹œ ìƒê²Œ ë˜ëŠ” ê²ƒì´ ì–´ë–»ê²Œ ë” ì»¤ì§€ëŠ”ê°€?</span>
                        <textarea id="p_18" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-orange-500 mt-2"></textarea>
                    </div>

                    <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-red-600">
                        <span class="label-main text-lg">19. ëª¨ë“  ê²ƒì„ ìƒëŠ” ìˆœê°„ (All is Lost)</span>
                        <span class="label-sub">ìµœì•…ì˜ íŒ¨ë°°, ë©˜í† ì˜ ì£½ìŒ, í¬ë§ì´ ì—†ì–´ ë³´ì´ëŠ” ì§€ì </span>
                        <textarea id="p_19" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-red-500 mt-2"></textarea>
                    </div>
                </div>
            </div>

            <div>
                <h2 class="text-2xl font-bold text-white mb-2 border-b border-gray-700 pb-2">Step 5. ì ˆì • ë° ë§ˆë¬´ë¦¬ (Resolution)</h2>
                <div class="space-y-8">
                     <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-red-500">
                        <span class="label-main text-lg">20. ìµœì¢… ê²°ì „ (Climax)</span>
                        <span class="label-sub">ì£¼ì¸ê³µ vs ëŒ€ë¦½ì(í˜¹ì€ ìì‹ )ì˜ ì •ë©´ ìŠ¹ë¶€</span>
                        <textarea id="p_20" oninput="saveData()" rows="4" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-red-500 mt-2"></textarea>
                    </div>
                     <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-yellow-500">
                        <span class="label-main text-lg">21. ìµœì¢… ì„ íƒ (The Choice)</span>
                        <span class="label-sub">ìŠ¹ë¦¬ë¥¼ ìœ„í•´ ì£¼ì¸ê³µì´ í¬ìƒí•˜ê±°ë‚˜ í¬ê¸°í•˜ëŠ” ê°€ì¹˜</span>
                        <textarea id="p_21" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-yellow-500 mt-2"></textarea>
                    </div>
                     <div class="bg-gray-800 p-5 rounded-lg border-l-4 border-green-500">
                        <span class="label-main text-lg">22. í•´ì†Œì™€ ë³€í™” (Resolution)</span>
                        <span class="label-sub">ì‚¬ê±´ í›„ ë‹¬ë¼ì§„ ì„¸ê³„ì™€ ì£¼ì¸ê³µì˜ ëª¨ìŠµ</span>
                        <textarea id="p_22" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-700 rounded p-3 text-white focus:border-green-500 mt-2"></textarea>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        // === ë°ì´í„° êµ¬ì¡° (23ë‹¨ê³„ + ìƒì„¸ ìºë¦­í„° í¬í•¨) ===
        let projectData = {
            concept: { logline: "", question: "", target: "", hook: "", theme: "", setting: "", rules: "", statusQuo: "" },
            characters: [], // Detailed Objects
            plot: { p14: "", p15: "", p16: "", p17: "", p18: "", p19: "", p20: "", p21: "", p22: "" }
        };

        // ì´ˆê¸°í™”
        window.onload = function() {
            const saved = localStorage.getItem('storyEngineV2');
            if (saved) {
                projectData = JSON.parse(saved);
                loadUI();
            } else {
                addCharacter(); // ê¸°ë³¸ ìºë¦­í„° 1ëª…
            }
        };

        // ë°ì´í„° ì €ì¥
        function saveData() {
            // Concept
            const conceptFields = ['logline', 'question', 'target', 'hook', 'theme', 'setting', 'rules', 'statusQuo'];
            conceptFields.forEach(id => projectData.concept[id] = document.getElementById('f_' + id).value);

            // Plot
            const plotFields = ['p14', 'p15', 'p16', 'p17', 'p18', 'p19', 'p20', 'p21', 'p22'];
            plotFields.forEach(id => projectData.plot[id.replace('_','')] = document.getElementById('p_' + id.replace('p', '')).value);

            // Characters are saved individually via updateCharacter()

            localStorage.setItem('storyEngineV2', JSON.stringify(projectData));
            showSaveStatus();
        }

        function showSaveStatus() {
            const el = document.getElementById('save-status');
            el.style.opacity = '1';
            setTimeout(() => el.style.opacity = '0', 1000);
        }

        // UI ë¡œë“œ
        function loadUI() {
            // Concept
            for (const [key, val] of Object.entries(projectData.concept)) {
                if(document.getElementById('f_' + key)) document.getElementById('f_' + key).value = val;
            }
            // Plot
            for (const [key, val] of Object.entries(projectData.plot)) {
                 if(document.getElementById('p_' + key.replace('p',''))) document.getElementById('p_' + key.replace('p','')).value = val;
            }
            // Characters
            const list = document.getElementById('character-list');
            list.innerHTML = '';
            projectData.characters.forEach(c => renderCharacterCard(c));
        }

        // íƒ­ ì „í™˜
        function switchTab(id) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('tab-active'));
            document.getElementById('tab-' + id).classList.remove('hidden');
            document.getElementById('btn-' + id).classList.add('tab-active');
        }

        // === ìºë¦­í„° ê´€ë¦¬ (5ê°œ ì¹´í…Œê³ ë¦¬ ìƒì„¸ êµ¬í˜„) ===
        function addCharacter() {
            const newChar = {
                id: Date.now(),
                // Core
                name: "", role: "ì£¼ì¸ê³µ", color: "#ffffff",
                // 1. Inner Engine
                wound: "", want: "", need: "", flaw: "", values: "",
                // 2. Function
                position: "", secret: "", skill: "",
                // 3. Visual
                silhouette: "", item: "", habit: "", gap: "",
                // 4. Relations
                attitude: "", chemistry: "", history: "",
                // 5. Arc
                startState: "", catalyst: "", endState: ""
            };
            projectData.characters.push(newChar);
            renderCharacterCard(newChar);
            saveData();
        }

        function renderCharacterCard(c) {
            const list = document.getElementById('character-list');
            const card = document.createElement('div');
            card.className = "bg-gray-800 rounded-lg border border-gray-700 overflow-hidden";
            card.innerHTML = `
                <div class="bg-gray-700 p-4 flex justify-between items-center cursor-pointer" onclick="toggleCard(this)">
                    <div class="flex items-center gap-4">
                        <div class="w-4 h-12 rounded" style="background-color:${c.color || '#ccc'}"></div>
                        <div>
                            <input type="text" value="${c.name}" oninput="updateChar(${c.id}, 'name', this.value)" onclick="event.stopPropagation()" class="bg-transparent text-xl font-bold text-white focus:outline-none placeholder-gray-400" placeholder="ì´ë¦„ ì…ë ¥">
                            <span class="text-sm text-gray-400"> / </span>
                            <input type="text" value="${c.role}" oninput="updateChar(${c.id}, 'role', this.value)" onclick="event.stopPropagation()" class="bg-transparent text-sm text-gray-300 focus:outline-none placeholder-gray-500" placeholder="ì—­í• ">
                        </div>
                    </div>
                    <button onclick="deleteChar(${c.id}, event)" class="text-gray-500 hover:text-red-400">ğŸ—‘</button>
                </div>
                
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8 content-body">
                    
                    <div class="space-y-4">
                        <h4 class="text-blue-400 font-bold border-b border-gray-600 pb-1">1. ë‚´ë©´ ì—”ì§„ (Inner Engine)</h4>
                        <div><span class="label-sub">5. ìƒì²˜ (The Wound)</span><input oninput="updateChar(${c.id}, 'wound', this.value)" value="${c.wound}" class="input-dark"></div>
                        <div><span class="label-sub">6. ìš•ë§ (The Want)</span><input oninput="updateChar(${c.id}, 'want', this.value)" value="${c.want}" class="input-dark"></div>
                        <div><span class="label-sub">7. í•„ìš”/ê²°í• (The Need)</span><input oninput="updateChar(${c.id}, 'need', this.value)" value="${c.need}" class="input-dark"></div>
                        <div><span class="label-sub">8. ì¹˜ëª…ì  ê²°í•¨ (Fatal Flaw)</span><input oninput="updateChar(${c.id}, 'flaw', this.value)" value="${c.flaw}" class="input-dark"></div>
                        <div><span class="label-sub">ê°€ì¹˜ê´€ (Values)</span><input oninput="updateChar(${c.id}, 'values', this.value)" value="${c.values}" class="input-dark"></div>
                    </div>

                    <div class="space-y-4">
                        <h4 class="text-blue-400 font-bold border-b border-gray-600 pb-1">2. ê¸°ëŠ¥ & ê´€ê³„ (Function)</h4>
                        <div><span class="label-sub">9. ëŒ€ë¦½ì/ì„œì‚¬ì  í¬ì§€ì…˜</span><input oninput="updateChar(${c.id}, 'position', this.value)" value="${c.position}" class="input-dark"></div>
                        <div><span class="label-sub">ë¹„ë°€ (The Secret)</span><input oninput="updateChar(${c.id}, 'secret', this.value)" value="${c.secret}" class="input-dark"></div>
                        <div><span class="label-sub">10. ì¡°ë ¥/ë°©í•´ & íƒ€ì¸ê³¼ì˜ íƒœë„</span><textarea oninput="updateChar(${c.id}, 'attitude', this.value)" rows="2" class="input-dark">${c.attitude}</textarea></div>
                         <div><span class="label-sub">ê³¼ê±°ì‚¬ (History)</span><textarea oninput="updateChar(${c.id}, 'history', this.value)" rows="2" class="input-dark">${c.history}</textarea></div>
                    </div>

                    <div class="space-y-4">
                        <h4 class="text-blue-400 font-bold border-b border-gray-600 pb-1">3. ì‹œê° & í˜ë¥´ì†Œë‚˜ (Visual)</h4>
                        <div class="flex gap-2">
                             <div class="flex-1"><span class="label-sub">ì‹¤ë£¨ì—£/ì™¸í˜•</span><input oninput="updateChar(${c.id}, 'silhouette', this.value)" value="${c.silhouette}" class="input-dark"></div>
                             <div class="w-1/3"><span class="label-sub">ìƒì§•ìƒ‰ (Hex)</span><input type="color" oninput="updateChar(${c.id}, 'color', this.value); this.closest('.rounded-lg').querySelector('.w-4').style.backgroundColor=this.value" value="${c.color}" class="w-full h-10 bg-gray-800 border border-gray-600 rounded"></div>
                        </div>
                        <div><span class="label-sub">ì‹œê·¸ë‹ˆì²˜ ì•„ì´í…œ</span><input oninput="updateChar(${c.id}, 'item', this.value)" value="${c.item}" class="input-dark"></div>
                        <div><span class="label-sub">ë§íˆ¬/ë²„ë¦‡</span><input oninput="updateChar(${c.id}, 'habit', this.value)" value="${c.habit}" class="input-dark"></div>
                        <div><span class="label-sub">ì²«ì¸ìƒ vs ì‹¤ì œ (Gap)</span><input oninput="updateChar(${c.id}, 'gap', this.value)" value="${c.gap}" class="input-dark"></div>
                    </div>

                    <div class="space-y-4">
                        <h4 class="text-blue-400 font-bold border-b border-gray-600 pb-1">4. ì„±ì¥ ì•„í¬ (Arc)</h4>
                        <div><span class="label-sub">ì‹œì‘ì  (ê²°í•¨ ìƒíƒœ)</span><input oninput="updateChar(${c.id}, 'startState', this.value)" value="${c.startState}" class="input-dark"></div>
                        <div><span class="label-sub">ë³€í™”ì˜ ê³„ê¸°</span><input oninput="updateChar(${c.id}, 'catalyst', this.value)" value="${c.catalyst}" class="input-dark"></div>
                        <div><span class="label-sub">ë„ì°©ì  (ë³€í™”ëœ ëª¨ìŠµ)</span><input oninput="updateChar(${c.id}, 'endState', this.value)" value="${c.endState}" class="input-dark"></div>
                    </div>

                </div>
            `;
            list.appendChild(card);
        }

        function toggleCard(header) {
            // ì ‘ê¸°/í´ê¸° (ì„ íƒì‚¬í•­)
        }

        function updateChar(id, key, val) {
            const idx = projectData.characters.findIndex(c => c.id === id);
            if(idx > -1) {
                projectData.characters[idx][key] = val;
                saveData();
            }
        }

        function deleteChar(id, e) {
            e.stopPropagation();
            if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                projectData.characters = projectData.characters.filter(c => c.id !== id);
                saveData();
                loadUI();
            }
        }

        // Export & Clear
        function exportData() {
            const str = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(projectData, null, 2));
            const node = document.createElement('a');
            node.href = str;
            node.download = "story_engine_data.json";
            document.body.appendChild(node);
            node.click();
            node.remove();
        }

        function clearData() {
            if(confirm('ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('storyEngineV2');
                location.reload();
            }
        }
    </script>
</body>
</html>
