<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Engine v3.0 : Dark Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ë‹¤í¬ëª¨ë“œ ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #4b5563; }

        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼: ë°°ê²½ê³¼ ê±°ì˜ ë¹„ìŠ·í•˜ê²Œ, ëˆˆì´ í¸ì•ˆí•˜ë„ë¡ */
        .input-ghost { 
            @apply w-full bg-gray-800/50 text-gray-200 border border-transparent rounded px-3 py-2 transition duration-200; 
        }
        .input-ghost:focus { 
            @apply bg-gray-800 border-gray-600 outline-none ring-1 ring-blue-500/50; 
        }
        .input-card {
            @apply w-full bg-gray-900/50 text-sm text-gray-300 border border-gray-700 rounded px-2 py-1.5 focus:border-blue-500 focus:outline-none transition;
        }
        
        /* ë¼ë²¨ ìŠ¤íƒ€ì¼ */
        .label-main { @apply block text-sm font-bold text-blue-400 mb-1 mt-4; }
        .label-sub { @apply block text-xs text-gray-500 mb-1.5; }
        
        /* ì„¹ì…˜ êµ¬ë¶„ì„  */
        .section-divider { @apply border-b border-gray-800 pb-8 mb-8; }
    </style>
</head>
<body class="bg-gray-950 text-gray-300 font-sans h-screen flex overflow-hidden selection:bg-blue-500/30">

    <main class="flex-1 overflow-y-auto relative p-8 md:p-12 scroll-smooth">
        
        <div class="flex justify-between items-end mb-12 border-b border-gray-800 pb-4">
            <div>
                <h1 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">Story Engine v3.0</h1>
                <p class="text-sm text-gray-500 mt-1">Dark Dashboard Mode</p>
            </div>
            <div class="flex gap-2">
                <button onclick="exportData()" class="text-xs bg-gray-800 hover:bg-gray-700 text-gray-300 px-3 py-2 rounded border border-gray-700 transition">ğŸ“¥ JSON ì €ì¥</button>
                <button onclick="clearData()" class="text-xs bg-gray-900 hover:text-red-400 text-gray-600 px-3 py-2 rounded transition">ì´ˆê¸°í™”</button>
            </div>
        </div>

        <div id="save-status" class="fixed top-5 left-1/2 transform -translate-x-1/2 text-xs text-emerald-500 font-mono opacity-0 transition-opacity pointer-events-none">
            â— Auto-saved
        </div>

        <div class="section-divider">
            <h2 class="text-xl font-bold text-gray-100 flex items-center gap-2">
                <span class="bg-blue-900 text-blue-300 text-xs px-2 py-1 rounded">PART 1</span> 
                ì´ì•¼ê¸°ì˜ ì”¨ì•— (Concept)
            </h2>
            
            <div class="mt-6 space-y-2">
                <span class="label-main">1. ì•„ì´ëŸ¬ë‹ˆ ë¡œê·¸ë¼ì¸ (Irony Logline)</span>
                <textarea id="f_logline" oninput="saveData()" rows="2" class="input-ghost" placeholder="ì£¼ì¸ê³µì˜ íŠ¹ì„±ê³¼ ìƒí™©ì´ ëª¨ìˆœë˜ëŠ” í•œ ë¬¸ì¥..."></textarea>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                <div>
                    <span class="label-main">2. í•µì‹¬ ì§ˆë¬¸ (Dramatic Question)</span>
                    <input type="text" id="f_question" oninput="saveData()" class="input-ghost" placeholder="ì£¼ì¸ê³µì€ ê³¼ì—° ~í•  ìˆ˜ ìˆì„ê¹Œ?">
                </div>
                <div>
                    <span class="label-main">23. í…Œë§ˆ (Controlling Idea)</span>
                    <input type="text" id="f_theme" oninput="saveData()" class="input-ghost border-l-4 border-blue-500" placeholder="ê²°êµ­ ì´ ì´ì•¼ê¸°ëŠ” ~ì— ê´€í•œ ê²ƒì´ë‹¤.">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6 mt-4">
                <div><span class="label-main">3. íƒ€ê²Ÿ & ì¥ë¥´</span><input id="f_target" oninput="saveData()" class="input-ghost"></div>
                <div><span class="label-main">4. ì°¨ë³„í™” (The Hook)</span><input id="f_hook" oninput="saveData()" class="input-ghost"></div>
            </div>
        </div>

        <div class="section-divider">
            <h2 class="text-xl font-bold text-gray-100 flex items-center gap-2">
                <span class="bg-indigo-900 text-indigo-300 text-xs px-2 py-1 rounded">PART 2</span> 
                ì„¸ê³„ê´€ (World)
            </h2>
            <div class="mt-6 grid grid-cols-1 gap-4">
                <div><span class="label-main">11. ë°°ê²½ (Setting)</span><textarea id="f_setting" oninput="saveData()" rows="2" class="input-ghost"></textarea></div>
                <div><span class="label-main">12. ê·œì¹™ (Rules)</span><textarea id="f_rules" oninput="saveData()" rows="2" class="input-ghost"></textarea></div>
                <div><span class="label-main">13. ì¼ìƒì˜ ë¶•ê´´ ì „ (Status Quo)</span><textarea id="f_statusQuo" oninput="saveData()" rows="2" class="input-ghost"></textarea></div>
            </div>
        </div>

        <div class="pb-24">
            <h2 class="text-xl font-bold text-gray-100 flex items-center gap-2 mb-6">
                <span class="bg-purple-900 text-purple-300 text-xs px-2 py-1 rounded">PART 3</span> 
                í”Œë¡¯ì˜ íŒŒë™ (The Plot)
            </h2>

            <div class="space-y-6">
                <div class="bg-gray-900/40 p-5 rounded-lg border-l-2 border-emerald-500 hover:bg-gray-900 transition">
                    <h3 class="text-emerald-400 font-bold text-lg">14. ë„ì…ë¶€ ì‚¬ê±´ (Inciting Incident)</h3>
                    <p class="text-xs text-gray-500 mb-3">ì¼ìƒì— ë¶ˆì„ ì§€ë¥´ëŠ” ì‚¬ê±´</p>
                    <textarea id="p_14" oninput="saveData()" rows="3" class="input-ghost"></textarea>
                </div>

                <div class="bg-gray-900/40 p-5 rounded-lg border-l-2 border-blue-500 hover:bg-gray-900 transition">
                    <h3 class="text-blue-400 font-bold text-lg">15. íšŒê·€ ë¶ˆê°€ ì§€ì  (Point of No Return)</h3>
                    <p class="text-xs text-gray-500 mb-3">ìƒˆë¡œìš´ ì„¸ê³„ë¡œì˜ ì§„ì…</p>
                    <textarea id="p_15" oninput="saveData()" rows="3" class="input-ghost"></textarea>
                </div>

                <div class="bg-gray-900/40 p-5 rounded-lg border-l-2 border-blue-500 hover:bg-gray-900 transition">
                    <h3 class="text-blue-400 font-bold text-lg">16. ì‹œë ¨ê³¼ ìƒìŠ¹ (Rising Action)</h3>
                    <p class="text-xs text-gray-500 mb-3">ì ì  ì»¤ì§€ëŠ” ì¥ì• ë¬¼ë“¤</p>
                    <textarea id="p_16" oninput="saveData()" rows="4" class="input-ghost"></textarea>
                </div>

                <div class="bg-gray-800/80 p-6 rounded-lg border border-purple-500/30 shadow-lg shadow-purple-900/20">
                    <h3 class="text-purple-400 font-black text-xl">17. ë¯¸ë“œí¬ì¸íŠ¸ (Mid-point)</h3>
                    <p class="text-xs text-gray-400 mb-3">íŒì´ ë’¤ì§‘íˆëŠ” ê±°ëŒ€í•œ ë°˜ì „. ì£¼ì¸ê³µì˜ ê°ì„±.</p>
                    <textarea id="p_17" oninput="saveData()" rows="4" class="input-ghost bg-gray-900"></textarea>
                </div>

                <div class="bg-gray-900/40 p-5 rounded-lg border-l-2 border-orange-500 hover:bg-gray-900 transition">
                    <h3 class="text-orange-400 font-bold text-lg">18. íŒëˆ ìƒìŠ¹ (Stakes) & 19. íŒ¨ë°° (All is Lost)</h3>
                    <p class="text-xs text-gray-500 mb-3">ì‹¤íŒ¨ ì‹œ ìƒëŠ” ê²ƒì˜ í¬ê¸° & ìµœì•…ì˜ ì ˆë§</p>
                    <textarea id="p_18" oninput="saveData()" rows="3" class="input-ghost mb-2" placeholder="íŒëˆ ìƒìŠ¹..."></textarea>
                    <textarea id="p_19" oninput="saveData()" rows="3" class="input-ghost" placeholder="ëª¨ë“  ê²ƒì„ ìƒì€ ìˆœê°„..."></textarea>
                </div>

                <div class="bg-gray-900/40 p-5 rounded-lg border-l-2 border-red-500 hover:bg-gray-900 transition">
                    <h3 class="text-red-400 font-bold text-lg">20. í´ë¼ì´ë§¥ìŠ¤ & 21. ì„ íƒ</h3>
                    <p class="text-xs text-gray-500 mb-3">ìµœí›„ì˜ ê²°ì „ê³¼ ì£¼ì¸ê³µì˜ í¬ìƒì  ì„ íƒ</p>
                    <textarea id="p_20" oninput="saveData()" rows="4" class="input-ghost mb-2" placeholder="ê²°ì „..."></textarea>
                    <textarea id="p_21" oninput="saveData()" rows="2" class="input-ghost" placeholder="ìµœí›„ì˜ ì„ íƒ..."></textarea>
                </div>

                <div class="bg-gray-900/40 p-5 rounded-lg border-l-2 border-gray-500 hover:bg-gray-900 transition">
                    <h3 class="text-gray-300 font-bold text-lg">22. í•´ì†Œ (Resolution)</h3>
                    <p class="text-xs text-gray-500 mb-3">ë³€í™”ëœ ì„¸ê³„ì™€ ì—¬ìš´</p>
                    <textarea id="p_22" oninput="saveData()" rows="3" class="input-ghost"></textarea>
                </div>
            </div>
        </div>
    </main>

    <aside class="w-[400px] bg-gray-900 border-l border-gray-800 flex flex-col shadow-2xl z-10">
        <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-gray-900">
            <h2 class="text-lg font-bold text-gray-200">ğŸ­ Character Deck</h2>
            <button onclick="addCharacter()" class="bg-blue-600 hover:bg-blue-500 text-white text-xs px-3 py-1.5 rounded font-bold shadow transition">+ ì¶”ê°€</button>
        </div>
        
        <div id="character-list" class="flex-1 overflow-y-auto p-4 space-y-4">
            </div>
    </aside>

    <script>
        // === ë°ì´í„° êµ¬ì¡° ===
        let projectData = {
            concept: { logline: "", question: "", target: "", hook: "", theme: "", setting: "", rules: "", statusQuo: "" },
            characters: [], 
            plot: { p14: "", p15: "", p16: "", p17: "", p18: "", p19: "", p20: "", p21: "", p22: "" }
        };

        // ì´ˆê¸°í™”
        window.onload = function() {
            const saved = localStorage.getItem('storyDashboardV3');
            if (saved) {
                projectData = JSON.parse(saved);
                loadUI();
            } else {
                addCharacter(); // ê¸°ë³¸ 1ëª…
            }
        };

        // ë°ì´í„° ì €ì¥ & ìƒíƒœ í‘œì‹œ
        function saveData() {
            // Concept
            const conceptFields = ['logline', 'question', 'target', 'hook', 'theme', 'setting', 'rules', 'statusQuo'];
            conceptFields.forEach(id => {
                const el = document.getElementById('f_' + id);
                if(el) projectData.concept[id] = el.value;
            });

            // Plot
            const plotFields = ['p14', 'p15', 'p16', 'p17', 'p18', 'p19', 'p20', 'p21', 'p22'];
            plotFields.forEach(id => {
                const el = document.getElementById('p_' + id.replace('p', ''));
                if(el) projectData.plot[id.replace('_','')] = el.value;
            });

            localStorage.setItem('storyDashboardV3', JSON.stringify(projectData));
            
            const status = document.getElementById('save-status');
            status.style.opacity = '1';
            setTimeout(() => status.style.opacity = '0', 1000);
        }

        // UI ë¡œë“œ
        function loadUI() {
            for (const [key, val] of Object.entries(projectData.concept)) {
                if(document.getElementById('f_' + key)) document.getElementById('f_' + key).value = val;
            }
            for (const [key, val] of Object.entries(projectData.plot)) {
                 const el = document.getElementById('p_' + key.replace('p',''));
                 if(el) el.value = val;
            }
            const list = document.getElementById('character-list');
            list.innerHTML = '';
            projectData.characters.forEach(c => renderCharacterCard(c));
        }

        // === ìºë¦­í„° ê´€ë¦¬ ===
        function addCharacter() {
            const newChar = {
                id: Date.now(),
                name: "", role: "", color: "#3b82f6",
                // ë‚´ë©´
                wound: "", want: "", need: "", flaw: "", values: "",
                // ê¸°ëŠ¥
                position: "", secret: "", skill: "",
                // ì‹œê°
                silhouette: "", item: "", habit: "", gap: "",
                // ê´€ê³„/ì•„í¬
                attitude: "", chemistry: "", history: "",
                startState: "", catalyst: "", endState: "",
                isExpanded: true // ì ‘ê¸°/í¼ì¹˜ê¸° ìƒíƒœ ì €ì¥
            };
            projectData.characters.push(newChar);
            renderCharacterCard(newChar);
            saveData();
            // ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜ë¡œ
            setTimeout(() => {
                const list = document.getElementById('character-list');
                list.scrollTop = list.scrollHeight;
            }, 100);
        }

        function renderCharacterCard(c) {
            const list = document.getElementById('character-list');
            const card = document.createElement('div');
            card.className = "bg-gray-800 rounded-lg border-l-4 shadow-lg overflow-hidden transition-all duration-200 group";
            card.style.borderColor = c.color;

            // ì¹´ë“œ í—¤ë” (í´ë¦­ ì‹œ í¼ì¹˜ê¸°/ì ‘ê¸° êµ¬í˜„ ê°€ëŠ¥)
            card.innerHTML = `
                <div class="p-3 bg-gray-800 flex justify-between items-center cursor-pointer border-b border-gray-700 hover:bg-gray-750" onclick="toggleCard(${c.id})">
                    <div class="flex items-center gap-2 overflow-hidden">
                        <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color:${c.color}"></div>
                        <h3 class="font-bold text-gray-200 truncate max-w-[150px]">${c.name || 'ì´ë¦„ ì—†ìŒ'}</h3>
                        <span class="text-xs text-gray-500 truncate">${c.role || ''}</span>
                    </div>
                    <button onclick="deleteChar(${c.id}, event)" class="text-gray-600 hover:text-red-400 px-2">Ã—</button>
                </div>
                
                <div id="card-body-${c.id}" class="${c.isExpanded ? '' : 'hidden'} p-3 space-y-4 bg-gray-800">
                    
                    <div class="grid grid-cols-5 gap-2">
                        <div class="col-span-3">
                            <label class="label-sub">ì´ë¦„</label>
                            <input value="${c.name}" oninput="updateChar(${c.id}, 'name', this.value)" class="input-card font-bold text-white bg-gray-900">
                        </div>
                        <div class="col-span-2">
                            <label class="label-sub">ìƒì§•ìƒ‰</label>
                            <div class="flex items-center gap-1 bg-gray-900 rounded border border-gray-700 px-1">
                                <input type="color" value="${c.color}" oninput="updateCharColor(${c.id}, this.value, this)" class="w-full h-6 bg-transparent cursor-pointer">
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="label-sub">ì—­í• </label>
                        <input value="${c.role}" oninput="updateChar(${c.id}, 'role', this.value)" class="input-card" placeholder="ì£¼ì¸ê³µ, ì¡°ë ¥ì...">
                    </div>

                    <div class="pt-2 border-t border-gray-700">
                        <p class="text-xs font-bold text-blue-400 mb-2">ğŸ§  ë‚´ë©´ ì—”ì§„</p>
                        <div class="space-y-2">
                            <input value="${c.wound}" oninput="updateChar(${c.id}, 'wound', this.value)" class="input-card" placeholder="ìƒì²˜ (Wound)">
                            <input value="${c.want}" oninput="updateChar(${c.id}, 'want', this.value)" class="input-card" placeholder="ìš•ë§ (Want)">
                            <input value="${c.need}" oninput="updateChar(${c.id}, 'need', this.value)" class="input-card" placeholder="ê²°í• (Need)">
                            <input value="${c.flaw}" oninput="updateChar(${c.id}, 'flaw', this.value)" class="input-card" placeholder="ì¹˜ëª…ì  ê²°í•¨">
                        </div>
                    </div>

                    <div class="pt-2 border-t border-gray-700">
                        <p class="text-xs font-bold text-blue-400 mb-2">ğŸ¤« ë¹„ë°€ & ê´€ê³„</p>
                         <div class="space-y-2">
                            <input value="${c.secret}" oninput="updateChar(${c.id}, 'secret', this.value)" class="input-card" placeholder="ë¹„ë°€ (Secret)">
                            <textarea oninput="updateChar(${c.id}, 'attitude', this.value)" rows="2" class="input-card" placeholder="íƒ€ì¸ê³¼ì˜ íƒœë„">${c.attitude}</textarea>
                        </div>
                    </div>

                    <div class="pt-2 border-t border-gray-700">
                        <p class="text-xs font-bold text-blue-400 mb-2">ğŸ‘ï¸ ë¹„ì£¼ì–¼</p>
                        <div class="space-y-2">
                            <input value="${c.silhouette}" oninput="updateChar(${c.id}, 'silhouette', this.value)" class="input-card" placeholder="ì™¸í˜•/ì‹¤ë£¨ì—£">
                            <input value="${c.item}" oninput="updateChar(${c.id}, 'item', this.value)" class="input-card" placeholder="ì•„ì´í…œ">
                        </div>
                    </div>

                     <div class="pt-2 border-t border-gray-700">
                        <p class="text-xs font-bold text-blue-400 mb-2">ğŸ“ˆ ì„±ì¥</p>
                        <div class="space-y-2">
                            <input value="${c.startState}" oninput="updateChar(${c.id}, 'startState', this.value)" class="input-card" placeholder="ì‹œì‘ì ">
                            <input value="${c.endState}" oninput="updateChar(${c.id}, 'endState', this.value)" class="input-card" placeholder="ë„ì°©ì ">
                        </div>
                    </div>
                </div>
            `;
            list.appendChild(card);
        }

        function toggleCard(id) {
            const body = document.getElementById(`card-body-${id}`);
            const char = projectData.characters.find(c => c.id === id);
            
            if (body.classList.contains('hidden')) {
                body.classList.remove('hidden');
                if(char) char.isExpanded = true;
            } else {
                body.classList.add('hidden');
                if(char) char.isExpanded = false;
            }
            saveData();
        }

        function updateChar(id, key, val) {
            const idx = projectData.characters.findIndex(c => c.id === id);
            if(idx > -1) {
                projectData.characters[idx][key] = val;
                // ì´ë¦„ì´ë‚˜ ì—­í• ì´ ë°”ë€Œë©´ í—¤ë”ë„ ì—…ë°ì´íŠ¸í•´ì•¼ í•˜ë¯€ë¡œ ë¦¬ë Œë”ë§ ëŒ€ì‹  í…ìŠ¤íŠ¸ë§Œ ì°¾ì•„ì„œ ë°”ê¿”ì¤„ ìˆ˜ë„ ìˆìœ¼ë‚˜, 
                // ê°„ë‹¨í•˜ê²Œ ì €ì¥ë§Œ í•˜ê³  í—¤ë” ì—…ë°ì´íŠ¸ëŠ” ë‹¤ìŒ ë¡œë“œ ì‹œ ë°˜ì˜ë˜ê²Œ í•˜ê±°ë‚˜ DOM ì¡°ì‘.
                // ì—¬ê¸°ì„œëŠ” ì´ë¦„ ë³€ê²½ ì‹œ ì¦‰ì‹œ í—¤ë” ë°˜ì˜ì„ ìœ„í•´ DOM ì¡°ì‘ ì¶”ê°€
                if(key === 'name') {
                    // í—¤ë”ì˜ h3 ì°¾ê¸° (ì¢€ ë” ì •êµí•œ ì…€ë ‰í„° í•„ìš”í•˜ì§€ë§Œ ê°„ë‹¨íˆ êµ¬í˜„)
                    // ì‹¤ì‹œê°„ ë°˜ì˜ì€ ë³µì¡ë„ë¥¼ ë†’ì´ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ë°ì´í„° ì €ì¥ë§Œ ìš°ì„ .
                }
                saveData();
            }
        }

        function updateCharColor(id, color, inputEl) {
            const idx = projectData.characters.findIndex(c => c.id === id);
            if(idx > -1) {
                projectData.characters[idx].color = color;
                // ì¹´ë“œ í…Œë‘ë¦¬ ìƒ‰ìƒ ì¦‰ì‹œ ë³€ê²½
                inputEl.closest('.rounded-lg').style.borderColor = color;
                // í—¤ë”ì˜ ì› ìƒ‰ìƒ ë³€ê²½
                inputEl.closest('.rounded-lg').querySelector('.rounded-full').style.backgroundColor = color;
                saveData();
            }
        }

        function deleteChar(id, e) {
            e.stopPropagation();
            if(confirm('ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                projectData.characters = projectData.characters.filter(c => c.id !== id);
                saveData();
                loadUI();
            }
        }

        function exportData() {
            const str = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(projectData, null, 2));
            const node = document.createElement('a');
            node.href = str;
            node.download = "story_dashboard.json";
            document.body.appendChild(node);
            node.click();
            node.remove();
        }

        function clearData() {
            if(confirm('ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('storyDashboardV3');
                location.reload();
            }
        }
    </script>
</body>
</html>
