<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystery Story Architect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .tab-active { border-left: 4px solid #10b981; background-color: #1f2937; color: white; }
    </style>
</head>
<body class="bg-gray-900 text-gray-300 font-sans h-screen flex overflow-hidden">

    <aside class="w-64 bg-gray-800 flex flex-col border-r border-gray-700 flex-shrink-0">
        <div class="p-6 border-b border-gray-700">
            <h1 class="text-xl font-bold text-emerald-400">ğŸ•µï¸â€â™‚ï¸ Mystery Architect</h1>
            <p class="text-xs text-gray-500 mt-1">ìŠ¤í† ë¦¬ ì„¤ê³„ ì›Œí¬ì‹œíŠ¸</p>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <button onclick="switchTab('overview')" id="btn-overview" class="w-full text-left px-6 py-3 hover:bg-gray-700 transition tab-active">
                1. í”„ë¡œì íŠ¸ ê°œìš”
            </button>
            <button onclick="switchTab('mystery')" id="btn-mystery" class="w-full text-left px-6 py-3 hover:bg-gray-700 transition">
                2. ë¯¸ìŠ¤í…Œë¦¬ í•µì‹¬ (íŠ¸ë¦­)
            </button>
            <button onclick="switchTab('characters')" id="btn-characters" class="w-full text-left px-6 py-3 hover:bg-gray-700 transition">
                3. ìºë¦­í„° (ìš©ì˜ìë“¤)
            </button>
            <button onclick="switchTab('plot')" id="btn-plot" class="w-full text-left px-6 py-3 hover:bg-gray-700 transition">
                4. 7ë‹¨ê³„ í”Œë¡¯ êµ¬ì¡°
            </button>
        </nav>
        <div class="p-4 border-t border-gray-700">
            <button onclick="exportData()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-2 px-4 rounded font-bold transition flex items-center justify-center gap-2">
                <span>ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</span>
            </button>
            <button onclick="clearData()" class="w-full mt-2 text-xs text-red-400 hover:text-red-300">
                ì´ˆê¸°í™”
            </button>
        </div>
    </aside>

    <main class="flex-1 overflow-y-auto bg-gray-900 p-8 relative">
        
        <div id="save-status" class="fixed top-4 right-8 text-xs text-gray-500 opacity-0 transition-opacity">
            ìë™ ì €ì¥ë¨...
        </div>

        <section id="tab-overview" class="max-w-4xl mx-auto space-y-8">
            <h2 class="text-2xl font-bold text-white mb-6 border-b border-gray-700 pb-2">í”„ë¡œì íŠ¸ ê°œìš”</h2>
            
            <div class="grid grid-cols-1 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">ì œëª© (ê°€ì œ)</label>
                    <input type="text" id="title" oninput="saveData()" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-emerald-500 focus:outline-none" placeholder="ì˜ˆ: ë¶‰ì€ ì €íƒì˜ ì‚´ì¸">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">ë¡œê·¸ë¼ì¸ (Irony & Hook)</label>
                    <textarea id="logline" oninput="saveData()" rows="2" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-emerald-500 focus:outline-none" placeholder="ì£¼ì¸ê³µì˜ íŠ¹ì„±ê³¼ ìƒí™©ì´ ì¶©ëŒí•˜ëŠ” í•œ ë¬¸ì¥"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">í•µì‹¬ ì§ˆë¬¸ (Dramatic Question)</label>
                    <input type="text" id="coreQuestion" oninput="saveData()" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-emerald-500 focus:outline-none" placeholder="ì£¼ì¸ê³µì€ ê³¼ì—° ~ í•  ìˆ˜ ìˆì„ê¹Œ?">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">í…Œë§ˆ (Controlling Idea)</label>
                    <input type="text" id="theme" oninput="saveData()" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-emerald-500 focus:outline-none" placeholder="ê²°êµ­ ì´ ì´ì•¼ê¸°ëŠ” ~ì— ê´€í•œ ê²ƒì´ë‹¤.">
                </div>
            </div>
        </section>

        <section id="tab-mystery" class="max-w-4xl mx-auto space-y-8 hidden">
            <h2 class="text-2xl font-bold text-white mb-6 border-b border-gray-700 pb-2">ë¯¸ìŠ¤í…Œë¦¬ ì„¤ê³„ (Doyle & Christie)</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-emerald-400 mb-1">ê¸°ì´í•œ ë°œìƒ (The Bizarre Detail)</label>
                    <textarea id="bizarreDetail" oninput="saveData()" rows="3" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-emerald-500 focus:outline-none" placeholder="ë…¼ë¦¬ì ìœ¼ë¡œ ì„¤ëª…ë˜ì§€ ì•ŠëŠ” í˜„ì¥ì˜ íŠ¹ì§• (ì˜ˆ: ì§–ì§€ ì•Šì€ ê°œ, ì‚¬ë¼ì§„ í‰ê¸°)"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">í”¼í•´ì & ì£½ìŒì˜ ì´ìœ </label>
                    <textarea id="victimInfo" oninput="saveData()" rows="4" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-emerald-500 focus:outline-none" placeholder="ëˆ„êµ¬ì´ë©°, ì™œ ì£½ì–´ì•¼ í–ˆëŠ”ê°€? (ë¹„ë°€/ì£„)"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">ë²”í–‰ íŠ¸ë¦­ & ë„êµ¬</label>
                    <textarea id="trickInfo" oninput="saveData()" rows="4" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-emerald-500 focus:outline-none" placeholder="ì–´ë–»ê²Œ ë¶ˆê°€ëŠ¥í•´ ë³´ì´ëŠ” ë²”ì£„ë¥¼ ì €ì§ˆë €ëŠ”ê°€?"></textarea>
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-400 mb-1">ê²°ì •ì  ë‹¨ì„œ (The Clue)</label>
                    <input type="text" id="keyClue" oninput="saveData()" class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-white focus:border-emerald-500 focus:outline-none" placeholder="ê²°ë§ì—ì„œ ë¬´ë¦ì„ ì¹˜ê²Œ ë§Œë“¤ ë³µì„ ">
                </div>
            </div>
        </section>

        <section id="tab-characters" class="max-w-4xl mx-auto space-y-8 hidden">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2 mb-6">
                <h2 class="text-2xl font-bold text-white">ìºë¦­í„° (ìš©ì˜ì ë§¤íŠ¸ë¦­ìŠ¤)</h2>
                <button onclick="addCharacter()" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition">+ ìºë¦­í„° ì¶”ê°€</button>
            </div>
            
            <div id="character-list" class="space-y-6">
                </div>
        </section>

        <section id="tab-plot" class="max-w-4xl mx-auto space-y-8 hidden">
            <h2 class="text-2xl font-bold text-white mb-6 border-b border-gray-700 pb-2">7ë‹¨ê³„ êµ¬ì¡° (Robert McKee Flow)</h2>
            
            <div class="space-y-6">
                <div class="bg-gray-800 p-4 rounded border border-gray-700">
                    <h3 class="font-bold text-emerald-400 mb-2">1. ì‚¬ê±´ì˜ ë°œë‹¨ (Inciting Incident)</h3>
                    <p class="text-xs text-gray-500 mb-2">ì¼ìƒì˜ íŒŒê´´, ì£¼ì¸ê³µì´ ì‚¬ê±´ì„ ë§¡ê²Œ ë˜ëŠ” í•„ì—°ì  ì´ìœ </p>
                    <textarea id="plotStep1" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none"></textarea>
                </div>

                <div class="bg-gray-800 p-4 rounded border border-gray-700">
                    <h3 class="font-bold text-emerald-400 mb-2">2. ìš•ë§ì˜ ì¶©ëŒ (Conflict)</h3>
                    <p class="text-xs text-gray-500 mb-2">ì£¼ì¸ê³µì˜ ëª©í‘œ vs ë²”ì¸ì˜ ë°©í•´, ì²« ë²ˆì§¸ ì¥ë²½</p>
                    <textarea id="plotStep2" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none"></textarea>
                </div>

                <div class="bg-gray-800 p-4 rounded border border-gray-700">
                    <h3 class="font-bold text-emerald-400 mb-2">3. ë ˆë“œ í—¤ë§ê³¼ í˜¼ë€ (Rising Action)</h3>
                    <p class="text-xs text-gray-500 mb-2">ê°€ì¥ ìœ ë ¥í•œ ìš©ì˜ìê°€ ë²”ì¸ì´ ì•„ë‹˜ì´ ë°í˜€ì§, ìˆ˜ì‚¬ì˜ ë‚œí•­</p>
                    <textarea id="plotStep3" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none"></textarea>
                </div>

                <div class="bg-gray-800 p-4 rounded border border-gray-700">
                    <h3 class="font-bold text-emerald-400 mb-2">4. ë¯¸ë“œí¬ì¸íŠ¸ (Mid-point)</h3>
                    <p class="text-xs text-gray-500 mb-2">íŒì´ ë’¤ì§‘íˆëŠ” í° ì‚¬ê±´, ì£¼ì¸ê³µì´ ìˆ˜ë™ì  íƒœë„ì—ì„œ ëŠ¥ë™ì ìœ¼ë¡œ ë³€í•¨</p>
                    <textarea id="plotStep4" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none"></textarea>
                </div>

                <div class="bg-gray-800 p-4 rounded border border-gray-700">
                    <h3 class="font-bold text-emerald-400 mb-2">5. ìœ„ê¸°ì™€ ì„ íƒ (Crisis)</h3>
                    <p class="text-xs text-gray-500 mb-2">ì£¼ì¸ê³µì´ ì§„ì‹¤ì„ ìœ„í•´ ê°€ì¥ ì†Œì¤‘í•œ ê²ƒì„ ê±¸ì–´ì•¼ í•˜ëŠ” ìˆœê°„</p>
                    <textarea id="plotStep5" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none"></textarea>
                </div>

                <div class="bg-gray-800 p-4 rounded border border-gray-700">
                    <h3 class="font-bold text-emerald-400 mb-2">6. í´ë¼ì´ë§¥ìŠ¤ (Climax)</h3>
                    <p class="text-xs text-gray-500 mb-2">ë²”ì¸ê³¼ì˜ ìµœí›„ ëŒ€ê²°, íŠ¸ë¦­ì˜ íŒŒí›¼</p>
                    <textarea id="plotStep6" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none"></textarea>
                </div>

                <div class="bg-gray-800 p-4 rounded border border-gray-700">
                    <h3 class="font-bold text-emerald-400 mb-2">7. ê²°ë§ê³¼ ì—¬ìš´ (Resolution)</h3>
                    <p class="text-xs text-gray-500 mb-2">ì‚¬ê±´ ì´í›„ ë³€í™”ëœ ì„¸ê³„ì™€ ì£¼ì¸ê³µ</p>
                    <textarea id="plotStep7" oninput="saveData()" rows="3" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none"></textarea>
                </div>
            </div>
        </section>

    </main>

    <script>
        // ë°ì´í„° êµ¬ì¡° ì •ì˜
        let storyData = {
            overview: { title: "", logline: "", coreQuestion: "", theme: "" },
            mystery: { bizarreDetail: "", victimInfo: "", trickInfo: "", keyClue: "" },
            characters: [], // [{id, name, role, desire, secret, ...}]
            plot: { step1: "", step2: "", step3: "", step4: "", step5: "", step6: "", step7: "" }
        };

        // ì´ˆê¸°í™”
        window.onload = function() {
            const savedData = localStorage.getItem('mysteryStoryData');
            if (savedData) {
                storyData = JSON.parse(savedData);
                loadDataToUI();
            } else {
                // ê¸°ë³¸ ìºë¦­í„° 1ëª… ì¶”ê°€
                addCharacter(); 
            }
        };

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tabId) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('main > section').forEach(sec => sec.classList.add('hidden'));
            // ëª¨ë“  ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('tab-active'));

            // ì„ íƒëœ ì„¹ì…˜ ë³´ì´ê¸°
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('btn-' + tabId).classList.add('tab-active');
        }

        // ë°ì´í„° ì €ì¥ (Local Storage)
        function saveData() {
            // Overview
            storyData.overview.title = document.getElementById('title').value;
            storyData.overview.logline = document.getElementById('logline').value;
            storyData.overview.coreQuestion = document.getElementById('coreQuestion').value;
            storyData.overview.theme = document.getElementById('theme').value;

            // Mystery
            storyData.mystery.bizarreDetail = document.getElementById('bizarreDetail').value;
            storyData.mystery.victimInfo = document.getElementById('victimInfo').value;
            storyData.mystery.trickInfo = document.getElementById('trickInfo').value;
            storyData.mystery.keyClue = document.getElementById('keyClue').value;

            // Plot
            for(let i=1; i<=7; i++) {
                storyData.plot[`step${i}`] = document.getElementById(`plotStep${i}`).value;
            }

            // Characters: oninputì—ì„œ ê°œë³„ ì €ì¥ë¨ (ì•„ë˜ saveCharacterInput ì°¸ê³ )

            localStorage.setItem('mysteryStoryData', JSON.stringify(storyData));
            
            // ì €ì¥ ì•Œë¦¼
            const status = document.getElementById('save-status');
            status.style.opacity = '1';
            setTimeout(() => status.style.opacity = '0', 1000);
        }

        // UIì— ë°ì´í„° ë¡œë“œ
        function loadDataToUI() {
            // Overview
            document.getElementById('title').value = storyData.overview.title;
            document.getElementById('logline').value = storyData.overview.logline;
            document.getElementById('coreQuestion').value = storyData.overview.coreQuestion;
            document.getElementById('theme').value = storyData.overview.theme;

            // Mystery
            document.getElementById('bizarreDetail').value = storyData.mystery.bizarreDetail;
            document.getElementById('victimInfo').value = storyData.mystery.victimInfo;
            document.getElementById('trickInfo').value = storyData.mystery.trickInfo;
            document.getElementById('keyClue').value = storyData.mystery.keyClue;

            // Plot
            for(let i=1; i<=7; i++) {
                if(storyData.plot[`step${i}`]) {
                    document.getElementById(`plotStep${i}`).value = storyData.plot[`step${i}`];
                }
            }

            // Characters
            const list = document.getElementById('character-list');
            list.innerHTML = '';
            storyData.characters.forEach(char => renderCharacterCard(char));
            if(storyData.characters.length === 0) addCharacter();
        }

        // ìºë¦­í„° ì¶”ê°€
        function addCharacter() {
            const newChar = {
                id: Date.now(),
                name: "",
                role: "ìš©ì˜ì",
                desire: "", // ìš•ë§
                flaw: "", // ê²°í•¨
                secret: "", // ë¹„ë°€
                appearance: ""
            };
            storyData.characters.push(newChar);
            renderCharacterCard(newChar);
            saveData();
        }

        // ìºë¦­í„° ì¹´ë“œ ë Œë”ë§
        function renderCharacterCard(char) {
            const list = document.getElementById('character-list');
            const card = document.createElement('div');
            card.className = "bg-gray-800 p-6 rounded border border-gray-700 relative";
            card.innerHTML = `
                <button onclick="deleteCharacter(${char.id})" class="absolute top-4 right-4 text-gray-500 hover:text-red-400">âœ–</button>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">ì´ë¦„</label>
                        <input type="text" value="${char.name}" oninput="updateCharacter(${char.id}, 'name', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">ì—­í•  (í¬ì§€ì…˜)</label>
                        <select onchange="updateCharacter(${char.id}, 'role', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none">
                            <option value="ì£¼ì¸ê³µ" ${char.role === 'ì£¼ì¸ê³µ' ? 'selected' : ''}>ì£¼ì¸ê³µ (íƒì •)</option>
                            <option value="ëŒ€ë¦½ì" ${char.role === 'ëŒ€ë¦½ì' ? 'selected' : ''}>ëŒ€ë¦½ì (ë²”ì¸/ë¼ì´ë²Œ)</option>
                            <option value="ìš©ì˜ì" ${char.role === 'ìš©ì˜ì' ? 'selected' : ''}>ìš©ì˜ì</option>
                            <option value="ì¡°ë ¥ì" ${char.role === 'ì¡°ë ¥ì' ? 'selected' : ''}>ì¡°ë ¥ì</option>
                            <option value="í”¼í•´ì" ${char.role === 'í”¼í•´ì' ? 'selected' : ''}>í”¼í•´ì</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">ìš•ë§ (Want) / ê²°í• (Need)</label>
                        <input type="text" value="${char.desire}" oninput="updateCharacter(${char.id}, 'desire', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none" placeholder="ë¬´ì—‡ì„ ì›í•˜ê³  ë¬´ì—‡ì´ ë¶€ì¡±í•œê°€?">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">ì¹˜ëª…ì  ê²°í•¨ / ë¹„ë°€</label>
                        <input type="text" value="${char.secret || ''}" oninput="updateCharacter(${char.id}, 'secret', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none" placeholder="ê°ì¶”ê³  ìˆëŠ” ê²ƒ">
                    </div>
                    <div class="md:col-span-2">
                         <label class="block text-xs text-gray-500 mb-1">ì™¸í˜• íŠ¹ì§• / ë¹„ê³ </label>
                        <input type="text" value="${char.appearance || ''}" oninput="updateCharacter(${char.id}, 'appearance', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-emerald-500 focus:outline-none" placeholder="ì‹¤ë£¨ì—£, ìƒì§•ìƒ‰, ì•„ì´í…œ ë“±">
                    </div>
                </div>
            `;
            list.appendChild(card);
        }

        // ìºë¦­í„° ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateCharacter(id, field, value) {
            const charIndex = storyData.characters.findIndex(c => c.id === id);
            if (charIndex > -1) {
                storyData.characters[charIndex][field] = value;
                saveData();
            }
        }

        // ìºë¦­í„° ì‚­ì œ
        function deleteCharacter(id) {
            if(confirm('ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                storyData.characters = storyData.characters.filter(c => c.id !== id);
                saveData();
                loadDataToUI(); // ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
            }
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON ë‹¤ìš´ë¡œë“œ)
        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(storyData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "mystery_draft.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        // ë°ì´í„° ì´ˆê¸°í™”
        function clearData() {
            if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('mysteryStoryData');
                location.reload();
            }
        }
    </script>
</body>
</html>
