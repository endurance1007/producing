<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Engine v4.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style type="text/tailwindcss">
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* ë©”ì¸ ìŠ¤í† ë¦¬ ì…ë ¥ì°½ (ë„“ê³  í¸ì•ˆí•˜ê²Œ) */
        .input-dark { 
            @apply w-full bg-slate-800 text-gray-100 border border-slate-700 rounded-lg px-5 py-4 text-base focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none placeholder-slate-500 resize-none overflow-hidden leading-relaxed transition-colors duration-200; 
        }

        /* ìºë¦­í„° ì¹´ë“œ ë‚´ë¶€ ì…ë ¥ì°½ (ì¢ì€ ê³µê°„ìš©) */
        .input-card {
            @apply w-full bg-slate-900/80 text-gray-200 border border-slate-700 rounded px-2 py-1.5 text-xs focus:border-blue-500 focus:outline-none placeholder-slate-600 resize-none overflow-hidden mb-1;
        }

        /* ì„¹ì…˜ ì¹´ë“œ ìŠ¤íƒ€ì¼ (í†µì¼ë¨) */
        .section-card { @apply bg-slate-900/40 rounded-xl p-6 border border-slate-800 hover:border-slate-700 transition-colors duration-300 shadow-sm relative; }
        
        /* í•­ëª© ì œëª© ìŠ¤íƒ€ì¼ (Part 1,2,3 í†µì¼) */
        .item-title { @apply font-bold text-lg mb-2 flex items-center gap-2; }
        .item-desc { @apply text-xs text-slate-500 mb-3 block; }

        /* Part í—¤ë” ìŠ¤íƒ€ì¼ */
        .part-header { @apply flex items-center gap-3 text-xl font-bold text-gray-200 mb-8 mt-12 pb-4 border-b border-slate-800 sticky top-0 bg-slate-950/95 z-10 backdrop-blur; }
        .part-badge { @apply text-xs px-2 py-1 rounded font-bold tracking-wide; }
        
        /* ìºë¦­í„° ì¹´í…Œê³ ë¦¬ í—¤ë” */
        .char-cat-header { @apply text-[10px] font-black text-blue-400 uppercase tracking-widest border-b border-slate-700 pb-1 mb-2 mt-4; }
        .label-card { @apply block text-[10px] font-bold text-slate-500 mb-0.5; }
    </style>
</head>
<body class="bg-slate-950 text-slate-300 font-sans h-screen flex overflow-hidden selection:bg-blue-500/30">

    <main class="flex-1 overflow-y-auto relative p-8 md:p-16 scroll-smooth max-w-5xl mx-auto" id="main-scroll">
        
        <div class="mb-12">
            <div class="flex justify-between items-start mb-6">
                <div class="w-full mr-8">
                    <h1 class="text-[10px] font-bold text-slate-500 tracking-widest uppercase mb-2">Story Engine v4.5</h1>
                    <input id="f_title" oninput="saveData()" class="bg-transparent text-2xl md:text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-100 to-emerald-100 placeholder-slate-700 focus:outline-none w-full border-b border-transparent focus:border-slate-800 transition-colors pb-2" placeholder="ì´ì•¼ê¸°ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (í´ë¦­í•˜ì—¬ ìˆ˜ì •)">
                </div>
                <div class="flex gap-2 shrink-0">
                    <button onclick="exportData()" class="text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 px-4 py-2 rounded-lg border border-slate-700 transition">ğŸ“¥ ì €ì¥</button>
                    <button onclick="clearData()" class="text-xs bg-transparent hover:text-red-400 text-slate-600 px-4 py-2 rounded transition">ì´ˆê¸°í™”</button>
                </div>
            </div>
            <div id="save-status" class="text-xs text-emerald-500 font-mono opacity-0 transition-opacity">â— Auto-saved</div>
        </div>

        <div>
            <div class="part-header">
                <span class="part-badge bg-blue-900/30 text-blue-400">PART 1</span> 
                ì»¨ì…‰ & êµ¬ì¡°
            </div>
            
            <div class="space-y-8">
                <div class="section-card border-l-4 border-l-blue-500">
                    <h3 class="item-title text-blue-400">1. ì•„ì´ëŸ¬ë‹ˆ ë¡œê·¸ë¼ì¸ (The Hook)</h3>
                    <span class="item-desc">ì£¼ì¸ê³µì˜ íŠ¹ì„±ê³¼ ìƒí™©ì´ ëª¨ìˆœë˜ëŠ” ê²°ì •ì  í•œ ë¬¸ì¥</span>
                    <textarea id="f_logline" oninput="autoResize(this); saveData()" rows="1" class="input-dark text-lg font-medium" placeholder="ì˜ˆ: ë¬¼ì„ ë¬´ì„œì›Œí•˜ëŠ” ì†Œë°©ê´€ì´ í™ìˆ˜ ì†ì— ê°‡í˜€ ì‚¬ëŒë“¤ì„ êµ¬í•´ì•¼ í•œë‹¤."></textarea>
                </div>

                <div class="section-card">
                    <h3 class="item-title text-slate-300">2. í•µì‹¬ ì§ˆë¬¸ (Dramatic Question)</h3>
                    <span class="item-desc">ì´ì•¼ê¸°ì˜ ì‹œì‘ë¶€í„° ëê¹Œì§€ ë…ìë¥¼ ë¶™ì¡ì•„ë‘ëŠ” ì§ˆë¬¸</span>
                    <textarea id="f_question" oninput="autoResize(this); saveData()" rows="1" class="input-dark" placeholder="ì˜ˆ: ê³¼ì—° ì£¼ì¸ê³µì€ íŠ¸ë¼ìš°ë§ˆë¥¼ ê·¹ë³µí•˜ê³  ì•„ì´ë¥¼ êµ¬í•´ë‚¼ ìˆ˜ ìˆì„ê¹Œ?"></textarea>
                </div>

                <div class="section-card">
                    <h3 class="item-title text-slate-300">3. íƒ€ê²Ÿ & ì¥ë¥´</h3>
                    <span class="item-desc">ëˆ„ê°€ ì´ ì´ì•¼ê¸°ë¥¼ ë³´ë©°, ì–´ë–¤ ê°ì •ì„ ëŠë¼ê¸¸ ì›í•˜ëŠ”ê°€?</span>
                    <textarea id="f_target" oninput="autoResize(this); saveData()" rows="1" class="input-dark" placeholder="ì˜ˆ: 2030 ì§ì¥ì¸ / ì˜¤í”¼ìŠ¤ ìŠ¤ë¦´ëŸ¬ / ê¸´ì¥ê°ê³¼ ì¹´íƒ€ë¥´ì‹œìŠ¤"></textarea>
                </div>

                <div class="section-card">
                    <h3 class="item-title text-slate-300">4. ì°¨ë³„í™” í¬ì¸íŠ¸ (The Hook)</h3>
                    <span class="item-desc">ê¸°ì¡´ì˜ ë¹„ìŠ·í•œ ì‘í’ˆë“¤ê³¼ ê²°ì •ì ìœ¼ë¡œ ë‹¤ë¥¸ í•œ ë—</span>
                    <textarea id="f_hook" oninput="autoResize(this); saveData()" rows="1" class="input-dark" placeholder="ì˜ˆ: íƒì •ì´ ì•„ë‹Œ ë²”ì¸ì˜ ì‹œì ì—ì„œ ì„œìˆ ë˜ëŠ” ì¶”ë¦¬ë¬¼"></textarea>
                </div>

                <div class="section-card border border-blue-500/30 bg-blue-900/10">
                    <h3 class="item-title text-blue-300">5. í…Œë§ˆ (Theme)</h3>
                    <span class="item-desc">ê²°êµ­ ì´ ì´ì•¼ê¸°ëŠ” ë¬´ì—‡ì— ê´€í•œ ê²ƒì¸ê°€? (ì‘ê°€ê°€ í•˜ê³  ì‹¶ì€ ë§)</span>
                    <textarea id="f_theme" oninput="autoResize(this); saveData()" rows="1" class="input-dark bg-blue-900/20 border-blue-500/30 focus:border-blue-400" placeholder="ì˜ˆ: ì§„ì •í•œ ìš©ê¸°ëŠ” ë‘ë ¤ì›€ì´ ì—†ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë‘ë ¤ì›€ì— ë§ì„œëŠ” ê²ƒì´ë‹¤."></textarea>
                </div>
            </div>
        </div>

        <div>
            <div class="part-header">
                <span class="part-badge bg-indigo-900/30 text-indigo-400">PART 2</span> 
                ì„¸ê³„ê´€ (World)
            </div>
            <div class="space-y-8">
                <div class="section-card">
                    <h3 class="item-title text-indigo-400">6. ë°°ê²½ (Setting)</h3>
                    <span class="item-desc">ì´ì•¼ê¸°ê°€ í¼ì³ì§€ëŠ” ì‹œê³µê°„ì  ë°°ê²½ê³¼ ë¶„ìœ„ê¸°</span>
                    <textarea id="f_setting" oninput="autoResize(this); saveData()" rows="1" class="input-dark" placeholder="ì˜ˆ: 2050ë…„ ì„œìš¸, ë“ì„ì—†ì´ ë¹„ê°€ ë‚´ë¦¬ëŠ” ì‚¬ì´ë²„í‘í¬ ë¹ˆë¯¼ê°€. ìŠµí•˜ê³  ì–´ë‘ìš´ ëŠì™€ë¥´ ë¶„ìœ„ê¸°."></textarea>
                </div>

                <div class="section-card">
                    <h3 class="item-title text-indigo-400">7. ê·œì¹™ (Rules)</h3>
                    <span class="item-desc">ì´ ì„¸ê³„ì—ì„œë§Œ í†µìš©ë˜ëŠ” ë²•ì¹™ì´ë‚˜ ì œì•½</span>
                    <textarea id="f_rules" oninput="autoResize(this); saveData()" rows="2" class="input-dark" placeholder="ì˜ˆ: ëª¨ë“  ì‹œë¯¼ì€ ë‡Œì— ì¹©ì„ ì´ì‹í•´ì•¼ í•˜ë©°, ê°ì • ìˆ˜ì¹˜ê°€ 80ì„ ë„˜ìœ¼ë©´ ê²½ë³´ê°€ ìš¸ë¦°ë‹¤."></textarea>
                </div>

                <div class="section-card">
                    <h3 class="item-title text-indigo-400">8. ì¼ìƒì˜ ë¶•ê´´ ì „ (Status Quo)</h3>
                    <span class="item-desc">ì‚¬ê±´ì´ í„°ì§€ê¸° ì „, ì£¼ì¸ê³µì´ ê²¬ë””ê³  ìˆë˜ í‰ë²”í•œ ì¼ìƒ</span>
                    <textarea id="f_statusQuo" oninput="autoResize(this); saveData()" rows="2" class="input-dark" placeholder="ì˜ˆ: ê°ì •ì„ ì–µëˆ„ë¥´ë©° í•˜ê¸‰ ê³µë¬´ì›ìœ¼ë¡œ í•˜ë£¨í•˜ë£¨ ê¸°ê³„ì²˜ëŸ¼ ì‚´ì•„ê°€ëŠ” ì£¼ì¸ê³µ."></textarea>
                </div>
            </div>
        </div>

        <div class="pb-32">
            <div class="part-header">
                <span class="part-badge bg-purple-900/30 text-purple-400">PART 3</span> 
                í”Œë¡¯ì˜ íŒŒë™ (The Plot)
            </div>

            <div class="space-y-8 relative pl-4 md:pl-0">
                <div class="absolute left-[-10px] md:left-[-20px] top-6 bottom-6 w-0.5 bg-gradient-to-b from-blue-500 via-purple-500 to-emerald-500 opacity-20 hidden md:block"></div>

                <div class="section-card border-l-4 border-l-sky-500 relative">
                    <h3 class="item-title text-sky-400">9. ë„ì…ë¶€ ì‚¬ê±´ (Inciting Incident)</h3>
                    <span class="item-desc">ì£¼ì¸ê³µì˜ ì¼ìƒì— ë¶ˆì„ ì§€ë¥´ëŠ” ì‚¬ê±´ / ê±°ì ˆí•  ìˆ˜ ì—†ëŠ” ì œì•ˆ</span>
                    <textarea id="p_14" oninput="autoResize(this); saveData()" rows="2" class="input-dark" placeholder="ì˜ˆ: ì£¼ì¸ê³µì˜ ì§‘ì— ì •ì²´ë¥¼ ì•Œ ìˆ˜ ì—†ëŠ” ì†Œí¬ê°€ ë°°ë‹¬ë˜ê³ , ê·¸ ì•ˆì—ëŠ” 10ë…„ ì „ ì‹¤ì¢…ëœ ë™ìƒì˜ ì‹ ë¶„ì¦ì´ ë“¤ì–´ìˆë‹¤."></textarea>
                </div>

                <div class="section-card border-l-4 border-l-blue-500 relative">
                    <h3 class="item-title text-blue-400">10. íšŒê·€ ë¶ˆê°€ ì§€ì  (Point of No Return)</h3>
                    <span class="item-desc">ì£¼ì¸ê³µì´ ë§ì„¤ì„ì„ ëë‚´ê³  ìƒˆë¡œìš´ ì„¸ê³„ë¡œ ë°œì„ ë“¤ì´ëŠ” ìˆœê°„</span>
                    <textarea id="p_15" oninput="autoResize(this); saveData()" rows="2" class="input-dark" placeholder="ì˜ˆ: ì£¼ì¸ê³µì´ ì†Œí¬ì˜ ë°œì‹ ì§€ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•´ ì§ì¥ì— ì‚¬í‘œë¥¼ ë˜ì§€ê³  ê¸ˆì§€ êµ¬ì—­í–‰ ê¸°ì°¨ì— íƒ„ë‹¤."></textarea>
                </div>

                <div class="section-card border-l-4 border-l-indigo-500 relative">
                    <h3 class="item-title text-indigo-400">11. ì‹œë ¨ê³¼ ìƒìŠ¹ (Rising Action)</h3>
                    <span class="item-desc">ëª©í‘œë¥¼ í–¥í•´ ë‚˜ì•„ê°€ì§€ë§Œ ê³„ì†í•´ì„œ ë¶€ë”ªíˆëŠ” 3~4ê°œì˜ ì¥ì• ë¬¼ë“¤</span>
                    <textarea id="p_16" oninput="autoResize(this); saveData()" rows="3" class="input-dark" placeholder="ì˜ˆ: 1) ì •ë³´ìƒì„ ë§Œë‚˜ëŸ¬ ê°”ë‹¤ê°€ ê°±ë‹¨ì— ì«“ê¹€. 2) ë¯¿ì—ˆë˜ ì¡°ë ¥ìê°€ ìŠ¤íŒŒì´ì˜€ìŒì´ ë°í˜€ì§. 3) ë‹¨ì„œë¥¼ ì°¾ì•˜ì§€ë§Œ ì•”í˜¸ê°€ ê±¸ë ¤ìˆìŒ."></textarea>
                </div>

                <div class="section-card border-l-4 border-l-purple-500 relative bg-purple-900/10 border-purple-500/50">
                    <h3 class="item-title text-purple-400">12. ë¯¸ë“œí¬ì¸íŠ¸ (Mid-point)</h3>
                    <span class="item-desc">íŒì´ ë’¤ì§‘íˆëŠ” ê±°ëŒ€í•œ ë°˜ì „. ì£¼ì¸ê³µì´ ìˆ˜ë™ì  íƒœë„ì—ì„œ ë²—ì–´ë‚˜ ê°ì„±í•¨.</span>
                    <textarea id="p_17" oninput="autoResize(this); saveData()" rows="3" class="input-dark bg-purple-900/20 border-purple-500/30" placeholder="ì˜ˆ: ë™ìƒì€ ì‹¤ì¢…ëœ ê²Œ ì•„ë‹ˆë¼, ì´ ë„ì‹œë¥¼ ì§€ë°°í•˜ëŠ” í‘ë§‰ì˜ ì˜¤ë¥¸íŒ”ì´ ë˜ì–´ ìˆì—ˆë‹¤. ì£¼ì¸ê³µì€ ë™ìƒì„ êµ¬í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ ë§‰ì•„ì•¼ í•¨ì„ ê¹¨ë‹«ëŠ”ë‹¤."></textarea>
                </div>

                <div class="section-card border-l-4 border-l-orange-500 relative">
                    <h3 class="item-title text-orange-400">13. íŒëˆ ìƒìŠ¹ & 14. íŒ¨ë°°</h3>
                    <span class="item-desc">ì‹¤íŒ¨ ì‹œ ìƒëŠ” ê²ƒì˜ í¬ê¸° & ìµœì•…ì˜ ì ˆë§(All is Lost)</span>
                    <div class="space-y-4">
                        <textarea id="p_18" oninput="autoResize(this); saveData()" rows="1" class="input-dark" placeholder="íŒëˆ: ë„ì‹œ ì „ì²´ì˜ ì‹œìŠ¤í…œì´ ë‹¤ìš´ë  ìœ„ê¸°. ì‹¤íŒ¨í•˜ë©´ ìì‹ ë¿ ì•„ë‹ˆë¼ ì‹œë¯¼ ì „ì›ì´ ì‚¬ë§í•œë‹¤."></textarea>
                        <textarea id="p_19" oninput="autoResize(this); saveData()" rows="1" class="input-dark" placeholder="ì ˆë§: ë™ìƒê³¼ì˜ ì²« ëŒ€ë©´ì—ì„œ ì™„íŒ¨í•˜ê³ , ìœ ì¼í•œ ë¬´ê¸°ë§ˆì € íŒŒê´´ëœë‹¤. ì•„ë¬´ëŸ° í¬ë§ì´ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤."></textarea>
                    </div>
                </div>

                <div class="section-card border-l-4 border-l-red-500 relative">
                    <h3 class="item-title text-red-400">15. í´ë¼ì´ë§¥ìŠ¤ & 16. ì„ íƒ</h3>
                    <span class="item-desc">ìµœí›„ì˜ ê²°ì „ê³¼ ì£¼ì¸ê³µì˜ í¬ìƒì  ì„ íƒ</span>
                     <div class="space-y-4">
                        <textarea id="p_20" oninput="autoResize(this); saveData()" rows="2" class="input-dark" placeholder="í´ë¼ì´ë§¥ìŠ¤: ì£¼ì¸ê³µì´ ìì‹ ì˜ ë‡Œ ì¹©ì„ ê³¼ë¶€í•˜ì‹œì¼œ ë¦¬ë¯¸í„°ë¥¼ í•´ì œí•˜ê³  ë™ìƒê³¼ ìµœí›„ì˜ ê²°ì „ì„ ë²Œì¸ë‹¤."></textarea>
                        <textarea id="p_21" oninput="autoResize(this); saveData()" rows="1" class="input-dark" placeholder="ì„ íƒ: ë™ìƒì„ ì£½ì—¬ì•¼ë§Œ ë„ì‹œë¥¼ êµ¬í•  ìˆ˜ ìˆë‹¤. ì£¼ì¸ê³µì€ ë™ìƒê³¼ í•¨ê»˜ ìí­í•˜ëŠ” ê¸¸ì„ ì„ íƒí•œë‹¤."></textarea>
                    </div>
                </div>

                <div class="section-card border-l-4 border-l-emerald-500 relative">
                    <h3 class="item-title text-emerald-400">17. í•´ì†Œ (Resolution)</h3>
                    <span class="item-desc">ì‚¬ê±´ì´ ëë‚œ í›„, ë³€í™”ëœ ì„¸ê³„ì™€ ì—¬ìš´</span>
                    <textarea id="p_22" oninput="autoResize(this); saveData()" rows="2" class="input-dark" placeholder="ì˜ˆ: ë„ì‹œì— ë¹„ê°€ ê·¸ì¹˜ê³  í•´ê°€ ëœ¬ë‹¤. ì‚´ì•„ë‚¨ì€ ì‚¬ëŒë“¤ì´ ì‹œìŠ¤í…œ ì—†ëŠ” ìƒˆë¡œìš´ ì‚¶ì„ ì‹œì‘í•œë‹¤. íí—ˆ ì†ì— ì£¼ì¸ê³µì˜ ë‚¡ì€ ë°°ì§€ë§Œì´ ë‚¨ì•„ìˆë‹¤."></textarea>
                </div>
            </div>
        </div>
    </main>

    <aside class="w-[400px] bg-slate-950 border-l border-slate-800 flex flex-col shadow-2xl z-20">
        <div class="p-5 border-b border-slate-800 flex justify-between items-center bg-slate-900">
            <h2 class="text-xs font-bold text-slate-300 uppercase tracking-widest">Character Deck</h2>
            <button onclick="addCharacter()" class="bg-blue-600 hover:bg-blue-500 text-white text-[10px] px-3 py-1.5 rounded font-bold shadow transition uppercase tracking-wider">+ New</button>
        </div>
        
        <div id="character-list" class="flex-1 overflow-y-auto p-4 space-y-4 pb-20">
            </div>
    </aside>

    <script>
        // === Auto Resize Function ===
        function autoResize(el) {
            el.style.height = 'auto'; 
            el.style.height = el.scrollHeight + 'px';
        }

        // === ë°ì´í„° êµ¬ì¡° ===
        let projectData = {
            title: "",
            concept: { logline: "", question: "", target: "", hook: "", theme: "", setting: "", rules: "", statusQuo: "" },
            characters: [], 
            plot: { p14: "", p15: "", p16: "", p17: "", p18: "", p19: "", p20: "", p21: "", p22: "" }
        };

        // ì´ˆê¸°í™”
        window.onload = function() {
            const saved = localStorage.getItem('storyDashboardFinal_v45');
            if (saved) {
                projectData = JSON.parse(saved);
                loadUI();
            } else {
                addCharacter();
            }
        };

        function saveData() {
            // Title
            const titleEl = document.getElementById('f_title');
            if(titleEl) projectData.title = titleEl.value;

            // Concept
            ['logline', 'question', 'target', 'hook', 'theme', 'setting', 'rules', 'statusQuo'].forEach(id => {
                const el = document.getElementById('f_' + id);
                if(el) projectData.concept[id] = el.value;
            });
            // Plot
            ['p14', 'p15', 'p16', 'p17', 'p18', 'p19', 'p20', 'p21', 'p22'].forEach(id => {
                const el = document.getElementById('p_' + id.replace('p', ''));
                if(el) projectData.plot[id.replace('_','')] = el.value;
            });

            localStorage.setItem('storyDashboardFinal_v45', JSON.stringify(projectData));
            
            const status = document.getElementById('save-status');
            status.style.opacity = '1';
            setTimeout(() => status.style.opacity = '0', 1000);
        }

        function loadUI() {
            // Title
            if(document.getElementById('f_title')) document.getElementById('f_title').value = projectData.title || "";

            // Concept & Plot
            for (const [key, val] of Object.entries(projectData.concept)) {
                const el = document.getElementById('f_' + key);
                if(el) { el.value = val; autoResize(el); }
            }
            for (const [key, val] of Object.entries(projectData.plot)) {
                 const el = document.getElementById('p_' + key.replace('p',''));
                 if(el) { el.value = val; autoResize(el); }
            }
            
            const list = document.getElementById('character-list');
            list.innerHTML = '';
            projectData.characters.forEach(c => renderCharacterCard(c));
        }

        // === ìºë¦­í„° ê´€ë¦¬ ===
        function addCharacter() {
            const newChar = {
                id: Date.now(),
                name: "", role: "", color: "#3b82f6",
                wound: "", want: "", need: "", flaw: "", values: "",
                position: "", secret: "", skill: "", attitude: "", history: "",
                silhouette: "", item: "", habit: "", gap: "",
                startState: "", catalyst: "", endState: "",
                isExpanded: true
            };
            projectData.characters.push(newChar);
            renderCharacterCard(newChar);
            saveData();
            setTimeout(() => {
                const list = document.getElementById('character-list');
                list.scrollTo({ top: list.scrollHeight, behavior: 'smooth' });
            }, 100);
        }

        function renderCharacterCard(c) {
            const list = document.getElementById('character-list');
            const card = document.createElement('div');
            card.className = "bg-slate-900 rounded-lg border-l-[4px] shadow-md overflow-hidden transition-all duration-200 group border-slate-800 mb-4";
            card.style.borderLeftColor = c.color;

            // í—¤ë”
            card.innerHTML = `
                <div class="p-3 bg-slate-900 flex justify-between items-center cursor-pointer border-b border-slate-800 hover:bg-slate-800" onclick="toggleCard(${c.id})">
                    <div class="flex items-center gap-3 overflow-hidden">
                        <div class="w-3 h-3 rounded-full flex-shrink-0" style="background-color:${c.color}"></div>
                        <div>
                            <h3 class="font-bold text-gray-200 text-sm truncate max-w-[150px]">${c.name || 'New Character'}</h3>
                            <p class="text-[10px] text-gray-500 truncate h-3">${c.role || ''}</p>
                        </div>
                    </div>
                    <button onclick="deleteChar(${c.id}, event)" class="text-gray-600 hover:text-red-400 px-2">Ã—</button>
                </div>
                
                <div id="card-body-${c.id}" class="${c.isExpanded ? '' : 'hidden'} p-4 bg-slate-900/50">
                    
                    <div class="grid grid-cols-5 gap-2 mb-2">
                        <div class="col-span-3">
                            <label class="label-card">ì´ë¦„</label>
                            <textarea oninput="updateChar(${c.id}, 'name', this.value); autoResize(this)" rows="1" class="input-card font-bold text-white border-slate-600">${c.name}</textarea>
                        </div>
                        <div class="col-span-2">
                             <label class="label-card">Color</label>
                             <div class="h-[30px] bg-slate-800 rounded border border-slate-700 flex items-center justify-center px-1 relative">
                                <input type="color" value="${c.color}" oninput="updateCharColor(${c.id}, this.value, this)" class="w-full h-full opacity-0 absolute cursor-pointer">
                                <div class="w-full h-4 rounded" style="background-color:${c.color}"></div>
                             </div>
                        </div>
                    </div>
                    <div>
                        <label class="label-card">ì—­í• </label>
                        <textarea oninput="updateChar(${c.id}, 'role', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ì˜ˆ: ì£¼ì¸ê³µ, ë©”ì¸ ë¹ŒëŸ°, ë©˜í† ...">${c.role}</textarea>
                    </div>

                    <div class="char-cat-header">Inner Engine</div>
                    <textarea oninput="updateChar(${c.id}, 'wound', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ìƒì²˜ (The Wound) - ê³¼ê±°ì˜ íŠ¸ë¼ìš°ë§ˆ">${c.wound}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'want', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ìš•ë§ (The Want) - ê²‰ìœ¼ë¡œ ì›í•˜ëŠ” ëª©í‘œ">${c.want}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'need', this.value); autoResize(this)" rows="1" class="input-card" placeholder="í•„ìš” (The Need) - ë‚´ì  ì„±ì¥ì„ ìœ„í•´ í•„ìš”í•œ ê²ƒ">${c.need}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'flaw', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ê²°í•¨ (Fatal Flaw) - ëª©í‘œë¥¼ ë°©í•´í•˜ëŠ” ì„±ê²©ì  ì•½ì ">${c.flaw}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'values', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ê°€ì¹˜ê´€ - ì˜ˆ: ì •ì˜ë³´ë‹¨ ëˆì´ ìš°ì„ ì´ë‹¤">${c.values}</textarea>

                    <div class="char-cat-header">Function & Relations</div>
                    <textarea oninput="updateChar(${c.id}, 'position', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ì„œì‚¬ì  í¬ì§€ì…˜ - ì˜ˆ: ì£¼ì¸ê³µì˜ ê·¸ë¦¼ì">${c.position}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'secret', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ë¹„ë°€ - ë¬´ë¤ê¹Œì§€ ê°€ì ¸ê°ˆ ë¹„ë°€">${c.secret}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'skill', this.value); autoResize(this)" rows="1" class="input-card" placeholder="íŠ¹ê¸°/ìŠ¤í‚¬ - ì˜ˆ: í•´í‚¹, ê±°ì§“ë§ ê°„íŒŒ">${c.skill}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'attitude', this.value); autoResize(this)" rows="1" class="input-card" placeholder="íƒœë„ - ì˜ˆ: ê°•ìì—ê² ì•½í•˜ê³  ì•½ìì—ê² ê°•í•¨">${c.attitude}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'history', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ê³¼ê±°ì‚¬ - í•µì‹¬ì ì¸ ê³¼ê±° ì´ë ¥">${c.history}</textarea>

                    <div class="char-cat-header">Visual</div>
                    <textarea oninput="updateChar(${c.id}, 'silhouette', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ì™¸í˜• - ì˜ˆ: 190cm, êµ¬ë¶€ì •í•œ ì–´ê¹¨, í‰í„°">${c.silhouette}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'item', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ì•„ì´í…œ - ì˜ˆ: ë‚¡ì€ ì§€í¬ ë¼ì´í„°">${c.item}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'habit', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ë§íˆ¬/ë²„ë¦‡ - ì˜ˆ: ë§ëë§ˆë‹¤ 'ì•„ë‹ˆ'ë¼ê³  í•¨">${c.habit}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'gap', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ë°˜ì „ ë§¤ë ¥ - ì˜ˆ: í—˜ìƒê¶‚ì§€ë§Œ ê³ ì–‘ì´ë¥¼ ì¢‹ì•„í•¨">${c.gap}</textarea>

                    <div class="char-cat-header">Arc</div>
                    <textarea oninput="updateChar(${c.id}, 'startState', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ì‹œì‘ì  - ì˜ˆ: ì´ê¸°ì ì¸ ê²ìŸì´">${c.startState}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'catalyst', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ê³„ê¸° - ì˜ˆ: ë™ë£Œì˜ ì£½ìŒ">${c.catalyst}</textarea>
                    <textarea oninput="updateChar(${c.id}, 'endState', this.value); autoResize(this)" rows="1" class="input-card" placeholder="ë„ì°©ì  - ì˜ˆ: í¬ìƒì„ ì•„ëŠ” ë¦¬ë”">${c.endState}</textarea>

                </div>
            `;
            list.appendChild(card);
            card.querySelectorAll('textarea').forEach(el => autoResize(el));
        }

        function toggleCard(id) {
            const body = document.getElementById(`card-body-${id}`);
            const char = projectData.characters.find(c => c.id === id);
            body.classList.toggle('hidden');
            if(char) char.isExpanded = !body.classList.contains('hidden');
            saveData();
        }

        function updateChar(id, key, val) {
            const idx = projectData.characters.findIndex(c => c.id === id);
            if(idx > -1) {
                projectData.characters[idx][key] = val;
                saveData();
            }
        }

        function updateCharColor(id, color, inputEl) {
            const idx = projectData.characters.findIndex(c => c.id === id);
            if(idx > -1) {
                projectData.characters[idx].color = color;
                inputEl.parentElement.querySelector('div').style.backgroundColor = color;
                inputEl.closest('.group').style.borderLeftColor = color;
                inputEl.closest('.group').querySelector('.rounded-full').style.backgroundColor = color;
                saveData();
            }
        }

        function deleteChar(id, e) {
            e.stopPropagation();
            if(confirm('ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                projectData.characters = projectData.characters.filter(c => c.id !== id);
                saveData();
                loadUI();
            }
        }
        function exportData() {
            const str = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(projectData, null, 2));
            const node = document.createElement('a');
            node.href = str;
            node.download = "story_engine_final_v4.5.json";
            document.body.appendChild(node);
            node.click();
            node.remove();
        }
        function clearData() {
            if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('storyDashboardFinal_v45');
                location.reload();
            }
        }
    </script>
</body>
</html>
